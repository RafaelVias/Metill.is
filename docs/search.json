[
  {
    "objectID": "posts/stjornmalaflokkar/index.html#opinber-framlög",
    "href": "posts/stjornmalaflokkar/index.html#opinber-framlög",
    "title": "Fjármál stjórnmálaflokkanna",
    "section": "Opinber framlög",
    "text": "Opinber framlög\n\nRíkissjóður\n\nDreifingMagn\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nSveitarfélög\n\nDreifingMagn\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nOpinber framlög alls\n\nDreifingMagn"
  },
  {
    "objectID": "posts/stjornmalaflokkar/index.html#fyrirtæki-og-lögaðilar",
    "href": "posts/stjornmalaflokkar/index.html#fyrirtæki-og-lögaðilar",
    "title": "Fjármál stjórnmálaflokkanna",
    "section": "Fyrirtæki og lögaðilar",
    "text": "Fyrirtæki og lögaðilar\n\nDreifingMagnMagn (Án 2007)"
  },
  {
    "objectID": "posts/stjornmalaflokkar/index.html#einstaklingar",
    "href": "posts/stjornmalaflokkar/index.html#einstaklingar",
    "title": "Fjármál stjórnmálaflokkanna",
    "section": "Einstaklingar",
    "text": "Einstaklingar\n\nDreifingMagn"
  },
  {
    "objectID": "posts/stjornmalaflokkar/index.html#aðrar-tekjur",
    "href": "posts/stjornmalaflokkar/index.html#aðrar-tekjur",
    "title": "Fjármál stjórnmálaflokkanna",
    "section": "Aðrar tekjur",
    "text": "Aðrar tekjur\n\nDreifingMagn"
  },
  {
    "objectID": "posts/stjornmalaflokkar/index.html#heildartekjur",
    "href": "posts/stjornmalaflokkar/index.html#heildartekjur",
    "title": "Fjármál stjórnmálaflokkanna",
    "section": "Heildartekjur",
    "text": "Heildartekjur\n\nDreifingMagn"
  },
  {
    "objectID": "posts/stjornmalaflokkar/index.html#eignir",
    "href": "posts/stjornmalaflokkar/index.html#eignir",
    "title": "Fjármál stjórnmálaflokkanna",
    "section": "Eignir",
    "text": "Eignir\n\nHeildareignir\n\nDreifingMagn\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFastafjármunir\n\nDreifingMagn"
  },
  {
    "objectID": "posts/stjornmalaflokkar/index.html#skuldir",
    "href": "posts/stjornmalaflokkar/index.html#skuldir",
    "title": "Fjármál stjórnmálaflokkanna",
    "section": "Skuldir",
    "text": "Skuldir\n\nDreifingMagn"
  },
  {
    "objectID": "posts/stjornmalaflokkar/index.html#eigið-fé",
    "href": "posts/stjornmalaflokkar/index.html#eigið-fé",
    "title": "Fjármál stjórnmálaflokkanna",
    "section": "Eigið fé",
    "text": "Eigið fé\n\nDreifingMagn"
  },
  {
    "objectID": "posts/visitala_neysluverds/index.html",
    "href": "posts/visitala_neysluverds/index.html",
    "title": "Vísitala neysluverðs",
    "section": "",
    "text": "Code\nd <- pxweb_get(\n    url =\"https://px.hagstofa.is:443/pxis/api/v1/is/Efnahagur/visitolur/1_vnv/2_undirvisitolur/VIS01301.px\", \n    query = list(\n        \"Mánuður\" = c(\"*\"),\n        \"Liður\"  = c(\"effect\", \"change_M\", \"breakdown\"),\n        \"Undirvísitala\" = c(\"*\")\n    ),\n    verbose = FALSE\n) |> \n    as.data.frame() |> \n    as_tibble() |> \n    janitor::clean_names() |> \n    separate(manudur, into = c(\"ar\", \"manudur\"), sep = \"M\", convert = T) |> \n    mutate(manudur = str_pad(manudur, width = 2, side = \"left\", pad = \"0\"),\n           date = str_c(ar, \"-\", manudur, \"-01\") |> ymd(),\n           visitala_neysluverds = visitala_neysluverds / 100) |> \n    select(date, undirvisitala, lidur, value = visitala_neysluverds) |> \n    filter(str_detect(undirvisitala, \"^[0-9]{2} |Vísitala neysluverðs\")) |>\n    arrange(date) |> \n    mutate(undirvisitala = str_replace(undirvisitala, \"^[0-9]{2} \", \"\"),\n           lidur = fct_recode(lidur,\n                              \"vaegi\" = \"Vægi, %\",\n                              \"breyting\" = \"Mánaðarbreyting, %\",\n                              \"ahrif\" = \"Áhrif á vísitölu, %\")) |> \n    pivot_wider(names_from = lidur, values_from = value)\n\n\n\nUndirvísitölur\nÍ grófum dráttum er vísitala neysluverðs vegið meðaltal af breytingu í verði hinna ýmsu afurða sem við kaupum. Því eru t.d. áhrif breytingar á húsnæðisverði reiknuð með því að margfalda verðbreytingar þess flokks við vægi hans í vísitölunni. Vægið á að endurspegla útgjöld einhvers konar meðal-Íslendings.\nFærið músina yfir myndirnar til að sjá nákvæm tölugildi og hvaða litir tilheyra hvaða flokkum.\n\nVísitalaVægiVerðbreyting\n\n\nDragið rennuna undir myndinni til að þysja inn á tiltekið tímabil.\n\n\nCode\nroll_fun <- function(x) {\n    x <- log(1 + x)\n    out <- x\n    \n    for (i in 1:11) out <- out + lag(x, n = i)\n    \n    exp(out) - 1\n}\n\n\nplot_dat <- d |> \n    arrange(date) |> \n    group_by(undirvisitala) |> \n    mutate(year_ahrif = roll_fun(ahrif),\n           year_breyting = roll_fun(breyting)) |> \n    ungroup() |> \n    filter(year(date) >= 2012) |> \n    mutate(undirvisitala = fct_reorder(undirvisitala, year_ahrif, .fun = sum),\n           text = str_c(\"<b>\", undirvisitala, \"</b>\\n\",\n                        \"Dagsetning: \", format(date, \"%B, %Y\"), \"\\n\",\n                        \"Hrein breyting (ár): \", percent(year_breyting, accuracy = 0.01), \"\\n\",\n                        \"Hrein breyting (mánuður): \", percent(breyting, accuracy = 0.01), \"\\n\",\n                        \"Vægi í vísitölu: \", percent(vaegi, accuracy = 0.01), \"\\n\",\n                        \"<b>Áhrif á vísitölu (ár): \", percent(year_ahrif, accuracy = 0.01), \"</b>\\n\",\n                        \"<b>Áhrif á vísitölu (mánuður): \", percent(ahrif, accuracy = 0.01), \"</b>\"))\n\n\n\np <- plot_dat |> \n    filter(undirvisitala != \"Vísitala neysluverðs\") |> \n    ggplot(aes(date, year_ahrif, text = text)) +\n    geom_hline(yintercept = 0, lty = 2) +\n    geom_col(aes(fill = undirvisitala, col = undirvisitala), position = \"stack\", width = 30) +\n    geom_line(data = plot_dat |> \n                  filter(undirvisitala == \"Vísitala neysluverðs\") |> \n                  mutate(text = str_c(\"<b>\", undirvisitala, \"</b>\\n\",\n                                      \"Dagsetning: \", format(date, \"%B, %Y\"), \"\\n\",\n                                      \"Hrein breyting (ár): \", percent(year_breyting, accuracy = 0.01), \"\\n\",\n                                      \"Hrein breyting (mánuður): \", percent(breyting, accuracy = 0.01), \"\\n\",\n                                      \"Vægi í vísitölu: \", percent(vaegi, accuracy = 0.01), \"\\n\",\n                                      \"<b>Áhrif á vísitölu (ár): \", percent(year_ahrif, accuracy = 0.01), \"</b>\\n\",\n                                      \"<b>Áhrif á vísitölu (mánuður): \", percent(ahrif, accuracy = 0.01), \"</b>\\n\")), \n              aes(group = \"none\")) +\n    scale_x_date(expand = expansion(),\n                 date_breaks = \"year\",\n                 date_labels = \"%Y\") +\n    scale_y_continuous(labels = label_percent(),\n                       breaks = c(-0.02, 0, 0.04, 0.06, 0.08, 0.1)) +\n    scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n    scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n    theme(legend.position = \"none\") +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Árleg breyting vísitölu og áhrif undirtalna\")\n\nggsave(plot = p, filename = \"undirtolur.png\",\n       width = 8, height = 0.621 * 8, scale = 1, bg = \"white\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n) |> \n    layout(hoverlabel = list(align = \"left\"),\n           xaxis = list(\n               rangeslider = list(type = \"date\")\n           )\n    )\n\n\n\n\n\n\n\n\nDragið rennuna undir myndinni til að þysja inn á tiltekið tímabil.\n\n\nCode\nroll_fun <- function(x) {\n    x <- log(1 + x)\n    out <- x\n    \n    for (i in 1:11) out <- out + lag(x, n = i)\n    \n    exp(out) - 1\n}\n\n\nplot_dat <- d |> \n    arrange(date) |> \n    group_by(undirvisitala) |> \n    mutate(year_ahrif = roll_fun(ahrif),\n           year_breyting = roll_fun(breyting)) |> \n    ungroup() |> \n    filter(year(date) >= 2012) |> \n    mutate(undirvisitala = fct_reorder(undirvisitala, year_ahrif, .fun = sum),\n           text = str_c(\"<b>\", undirvisitala, \"</b>\\n\",\n                        \"Dagsetning: \", format(date, \"%B, %Y\"), \"\\n\",\n                        \"Hrein breyting (ár): \", percent(year_breyting, accuracy = 0.01), \"\\n\",\n                        \"Hrein breyting (mánuður): \", percent(breyting, accuracy = 0.01), \"\\n\",\n                        \"<b>Vægi í vísitölu: \", percent(vaegi, accuracy = 0.01), \"</b>\\n\",\n                        \"Áhrif á vísitölu (ár): \", percent(year_ahrif, accuracy = 0.01), \"\\n\",\n                        \"Áhrif á vísitölu (mánuður): \", percent(ahrif, accuracy = 0.01)))\n\n\n\np <- plot_dat |> \n    filter(undirvisitala != \"Vísitala neysluverðs\") |> \n    ggplot(aes(date, vaegi, text = text)) +\n    geom_hline(yintercept = 0, lty = 2) +\n    geom_col(aes(fill = undirvisitala, col = undirvisitala), position = \"stack\", width = 30) +\n    scale_x_date(expand = expansion(),\n                 date_breaks = \"year\",\n                 date_labels = \"%Y\") +\n    scale_y_continuous(labels = label_percent(),\n                       breaks = pretty_breaks(8),\n                       expand = expansion()) +\n    scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n    scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n    theme(legend.position = \"none\") +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Vægi undirflokka í vísitölu neysluverðs\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n) |> \n    layout(hoverlabel = list(align = \"left\"),\n           xaxis = list(\n               rangeslider = list(type = \"date\")\n           ))\n\n\n\n\n\n\n\n\n\n\nCode\nroll_fun <- function(x) {\n    x <- log(1 + x)\n    out <- x\n    \n    for (i in 1:11) out <- out + lag(x, n = i)\n    \n    exp(out) - 1\n}\n\n\nplot_dat <- d |> \n    arrange(date) |> \n    group_by(undirvisitala) |> \n    mutate(year_ahrif = roll_fun(ahrif),\n           year_breyting = roll_fun(breyting)) |> \n    ungroup() |> \n    filter(year(date) >= 2012) |> \n    mutate(undirvisitala = fct_reorder(undirvisitala, year_ahrif, .fun = sum),\n           text = str_c(\"<b>\", undirvisitala, \"</b>\\n\",\n                        \"Dagsetning: \", format(date, \"%B, %Y\"), \"\\n\",\n                        \"<b>Hrein breyting (ár): \", percent(year_breyting, accuracy = 0.01), \"</b>\\n\",\n                        \"<b>Hrein breyting (mánuður): \", percent(breyting, accuracy = 0.01), \"</b>\\n\",\n                        \"Vægi í vísitölu: \", percent(vaegi, accuracy = 0.01), \"\\n\",\n                        \"Áhrif á vísitölu (ár): \", percent(year_ahrif, accuracy = 0.01), \"\\n\",\n                        \"Áhrif á vísitölu (mánuður): \", percent(ahrif, accuracy = 0.01)))\n\n\n\np <- plot_dat |> \n    filter(undirvisitala != \"Vísitala neysluverðs\") |> \n    ggplot(aes(date, year_breyting, text = text)) +\n    geom_hline(yintercept = 0, lty = 2) +\n    geom_col(aes(fill = undirvisitala, col = undirvisitala), width = 30) +\n    scale_x_date(expand = expansion(),\n                 date_breaks = \"2 year\",\n                 date_labels = \"%Y\") +\n    scale_y_continuous(labels = label_percent(),\n                       breaks = pretty_breaks(8)) +\n    scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n    scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n    facet_wrap(\"undirvisitala\", ncol = 3) +\n    theme(legend.position = \"none\") +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Árleg verðbreyting á undirflokkum vísitölu neysluverðs\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n) |> \n    layout(hoverlabel = list(align = \"left\"))\n\n\n\n\n\n\n\n\n\n\n\nÁrleg breyting og mánaðarleg breyting\nÞar sem árleg verðbólga samanstendur af verðbólgu síðustu 12 mánaða getur ekki hver og einn mánuður lækkað hana mikið. Ef mánaðarleg verðbólga síðustu 11 mánuði hefur verið 0,5% en hún mælist svo 0% verður árleg verðbólgan samt \\(1,005^{11} = 1,056 = 5,6\\%\\). Hins vegar getur verið gott að bera saman mánaðarlega verðbólgu við meðaltal síðastliðins árs. Ef mánaðarleg verðbólga er lægri en meðaltal síðasta árs er árleg verðbólga að lækka.\n\n\nCode\np <- plot_dat |> \n    mutate(text = str_c(\"<b>\", undirvisitala, \"</b>\\n\",\n                        \"Dagsetning: \", format(date, \"%B, %Y\"), \"\\n\",\n                        \"<b>Árleg (deilt með 12): \", percent(year_breyting/12, accuracy = 0.01), \"\\n</b>\",\n                        \"<b>Mánaðarleg: \", percent(breyting, accuracy = 0.01), \"</b>\")) |> \n    filter(undirvisitala == \"Vísitala neysluverðs\",\n           date >= ymd(\"2020-08-01\")) |> \n    ggplot(aes(year_ahrif/12, ahrif, text = text)) +\n    geom_abline(intercept = 0, slope = 1, lty = 2) +\n    geom_path(aes(group = \"none\")) +\n    scale_x_continuous(labels = label_percent()) +\n    scale_y_continuous(labels = label_percent()) +\n    coord_cartesian(ylim = c(0, 0.17)/12, xlim = c(0, 0.17)/12,\n                    expand = F) +\n    labs(x = \"Árleg verðbólga (deilt með 12)\",\n         y = \"Mánaðarleg verðbólga\",\n         title = \"Árleg verðbólga á móti mánaðarlegri verðbólgu (ágúst 2020 - ágúst 2022)\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n)\n\n\n\n\n\n\n\n\nSamræmd vísitala neysluverðs\n\n\nCode\nd_sam <- pxweb_get(\n    url =\"https://px.hagstofa.is:443/pxis/api/v1/is/Efnahagur/visitolur/2_samraemdvnv/samraemdvnv/VIS02201.px\", \n    query = list(\n        \"Flokkur\" = c(\"*\"),\n        \"Ár\" = c(\"*\")\n    ),\n    verbose = FALSE\n) |> \n    as.data.frame() |> \n    as_tibble() |> \n    janitor::clean_names() |> \n    rename(vaegi_samraemd = 3, undirvisitala = flokkur) |> \n    mutate(ar = parse_number(ar),\n           vaegi_samraemd = vaegi_samraemd / 1000) |> \n    filter(str_detect(undirvisitala, \"^[0-9]{2} \")) |> \n    mutate(undirvisitala = str_replace(undirvisitala, \"^[0-9]{2} \", \"\"))\n\n\n\n\nCode\nlvls <- plot_dat |> \n    distinct(undirvisitala) |> \n    filter(undirvisitala != \"Vísitala neysluverðs\")\n\nplot_dat <- d |> \n    filter(undirvisitala != \"Vísitala neysluverðs\") |> \n    select(date, undirvisitala, vaegi) |> \n    group_by(ar = year(date), undirvisitala) |> \n    summarise(vaegi = mean(vaegi)) |> \n    group_by(ar) |> \n    mutate(vaegi = vaegi / sum(vaegi)) |> \n    ungroup() |> \n    inner_join(\n        d_sam,\n        by = c(\"ar\", \"undirvisitala\")\n    ) |> \n    mutate(\n        undirvisitala = factor(undirvisitala, levels = levels(lvls$undirvisitala)),\n        text = str_c(\n            \"<b>\", undirvisitala, \"</b>\\n\",\n            \"Ár: \", ar, \"\\n\",\n            \"Vægi í vísitölu (Ísland): \", percent(vaegi, accuracy = 0.01), \"\\n\",\n            \"Vægi í vísitölu (Samræmd): \", percent(vaegi_samraemd, accuracy = 0.01))\n    )\n\np <- plot_dat |> \n    ggplot(aes(vaegi, vaegi_samraemd, frame = ar, text = text)) +\n    geom_abline(intercept = 0, slope = 1) +\n    geom_point(aes(col = undirvisitala)) +\n    scale_x_continuous(labels = label_percent()) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n    scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n    # theme_half_open() +\n    theme(legend.position = \"none\") +\n    labs(x = \"Vægi á Íslandi\",\n         y = \"Samræmt vægi\",\n         title = \"Samanburður á íslensku og samræmdu vægi\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n) |> \n    animation_opts(\n        transition = 500,\n        redraw = FALSE\n        \n    ) |> \n    animation_slider(currentvalue = list(prefix = \"Ár:\")) |> \n    layout(\n        hoverlabel = list(align = \"left\")\n    )"
  },
  {
    "objectID": "posts/kosningar/index.html",
    "href": "posts/kosningar/index.html",
    "title": "Alþingiskosningar",
    "section": "",
    "text": "Atkvæði og þingmenn\n\n\n\n\n\nMynd 1. Hvaða flokkar fá flesta þingmenn fyrir hvert atkvæði?\n\n\n\n\n\n\nPeningar\nRíkisendurskoðun birtir ársreikninga stjórnmálaflokkanna. Reyndar voru bara birtir útdrættir úr ársreikningunum fram til ársins 2019, en þar eru þó nægar upplýsingar til að framkvæma ýmsar greiningar. Til dæmis getum við skoðað útgjöld stjórnmálaflokka á hverju kjörtímabili og borið það saman við fjölda atkvæða í næstu kosningum.\n\n\n\n\n\n\nMynd 2. Meðaltal ársútgjalda frá síðustu kosningum deilt með fjölda atkvæða í yfirstandandi kosningum."
  },
  {
    "objectID": "posts/landspitali/index.html",
    "href": "posts/landspitali/index.html",
    "title": "Landspítalinn",
    "section": "",
    "text": "Gögnin eru fengin úr starfsemisupplýsingum Landspítala. Þar sem þetta er allt í PDF skjölum er ég ekki búinn að sækja öll gögnin, en ég birti hérna yfirlit yfir það helsta sem ég hef náð að safna saman. Það er kannski óþarfi að segja það, en það væri mikill kostur ef Landspítali myndi birta töflurnar úr þessum PDF skýrslum t.d. á csv formi, eða sem excel skrár. Seðlabankinn birtir t.d. excel skrár með viðeigandi gögnum samhliða PDF skýrslum sínum.\nEitt það besta sem yfirvöld geta gert til að auka traust á rekstri spítalans eða ákvarðanir í kringum hann er að auðvelda almenningi að nálgast upplýsingar um reksturinn. Það er ekki nóg að lesa/heyra í fjölmiðlum að einhver klár manneskja segir eitthvað um reksturinn, það verður að vera hægt að sannreyna þetta.\n\n\nCode\nd <- read_csv2(\"landspitali.csv\")\n\nvisitala <- pxweb_get(\n    url =\"https://px.hagstofa.is:443/pxis/api/v1/is/Efnahagur/visitolur/1_vnv/1_vnv/VIS01000.px\", \n    query = list(\n        \"Mánuður\" = c(\"*\"),\n        \"Vísitala\"  = c(\"CPI\"),\n        \"Liður\" = c(\"index\")\n    ),\n    verbose = FALSE\n) |> \n    as.data.frame() |> \n    as_tibble() |> \n    janitor::clean_names() |> \n    separate(manudur, into = c(\"ar\", \"manudur\"), sep = \"M\", convert = T) |> \n    mutate(manudur = str_pad(manudur, width = 2, side = \"left\", pad = \"0\"),\n           date = str_c(ar, \"-\", manudur, \"-01\") |> ymd()) |> \n    select(-manudur, -ar, -visitala, -lidur) |> \n    mutate(ar = year(date)) |> \n    group_by(ar) |> \n    filter(date == min(date)) |> \n    ungroup() |> \n    mutate(visitala_2022 = visitala_neysluverds / visitala_neysluverds[ar == 2022]) |> \n    select(-date, -visitala_neysluverds)\n\n\nurl_mannfjoldi <- \"https://px.hagstofa.is:443/pxis/api/v1/is/Ibuar/mannfjoldi/1_yfirlit/Yfirlit_mannfjolda/MAN00109.px\"\n\nquery_list_mannfjoldi <- list(\n    \"Ár\" = c(\"*\"),\n    \"Aldur\" = c(\"*\"),\n    \"Kyn\" = c(\"0\")\n)\n\n\nmannfjoldi <- pxweb_get(url_mannfjoldi, query = pxweb_query(query_list_mannfjoldi),\n                        verbose = FALSE) |> \n    as.data.frame() |> \n    as_tibble() |> \n    janitor::clean_names()  |> \n    filter(aldur == \"Alls\") |> \n    mutate(ar = parse_number(ar)) |> \n    group_by(ar) |> \n    summarise(mannfjoldi = sum(mannfjoldi_1841_2066))\n\nmannfjoldi <- pxweb_get(\n    url =\"https://px.hagstofa.is:443/pxis/api/v1/is/Ibuar/mannfjoldi/2_byggdir/sveitarfelog/MAN02005.px\", \n    query = list(\n        \"Sveitarfélag\" = c(\"*\"),\n        \"Aldur\" = c(\"-1\"),\n        \"Ár\" = c(\"*\"),\n        \"Kyn\" = c(\"0\")\n    ),\n    verbose = FALSE\n) |> \n    as.data.frame() |> \n    as_tibble() |> \n    janitor::clean_names() |> \n    rename(mannfjoldi = mannfjoldi_eftir_sveitarfelagi_kyni_og_aldri_1_januar_1998_2022) |> \n    mutate(ar = parse_number(ar)) |> \n    filter(sveitarfelag %in% c(\"Alls\", \"Reykjavíkurborg\", \"Garðabær\", \"Hafnarfjarðarkaupstaður\", \"Kópavogsbær\", \"Seltjarnarnesbær\", \"Mosfellsbær\")) |> \n    mutate(stadur = ifelse(sveitarfelag == \"Alls\", \"mannfjoldi_island\", \"mannfjoldi_hfbsv\")) |> \n    count(ar, stadur, wt = mannfjoldi) |> \n    pivot_wider(names_from = stadur, values_from = n)\n\nlands_laun <- read_csv(\"landspitali_laun.csv\") |> \n    rename(tegund_launa = tegund3,\n           samtals_laun = samtals)\n\nd <- d |> \n    inner_join(\n        visitala,\n        by = \"ar\"\n    ) |> \n    inner_join(\n        mannfjoldi,\n        by = \"ar\"\n    )"
  },
  {
    "objectID": "posts/landspitali/index.html#læknar-hjúkrunarfræðingar-og-sjúkraliðar",
    "href": "posts/landspitali/index.html#læknar-hjúkrunarfræðingar-og-sjúkraliðar",
    "title": "Landspítalinn",
    "section": "Læknar, Hjúkrunarfræðingar og Sjúkraliðar",
    "text": "Læknar, Hjúkrunarfræðingar og Sjúkraliðar\nÍ fréttum hefur verið talað um að of mikið starfsfólk sé ekki beintengt umönnun sjúklinga. Ein tilraun til að sannreyna þetta er að reikna hlutfall stöðugilda sem eru ekki hjúkrunarfræðingar, læknar eða sjúkraliðar. Þess ber þó að geta að meðlimir þessara stéttarfélaga geta líka sinnt stjórnenda/skrifstofustörfum að hluta til eða öllu leyti. Aðrar fagstéttir tengjast líka sjúklingum beint (t.d. sálfræðingar, lyfjafræðingar, meinafræðingar og sjúkraþjálfararar), en til einföldunar skoðum við hérna þessar þrjár stóru stéttir.\n\n\nCode\nplot_dat <- d |> \n    mutate(annad = stodugildi - stg_hjukr - stg_laekna - stg_sjukral,\n           hlutf_annad = annad / stodugildi) |> \n    select(ar, annad, hlutf_annad) |> \n    mutate(text = str_c(\"Ár: \", ar, \"\\n\",\n                        \"<b>Hlutfall: \", percent(hlutf_annad, accuracy = 0.1, big.mark = \".\", decimal.mark = \",\"), \"</b>\\n\",\n                        \"Fjöldi: \", number(annad, suffix = \" stöðugildi\", big.mark = \".\", decimal.mark = \",\"), \"\\n\")) |> \n    drop_na()\n\np <- plot_dat |> \n    ggplot(aes(ar, hlutf_annad, text = text)) +\n    geom_line(aes(group = \"none\")) +\n    scale_x_continuous(expand = expansion(add = 0.6),\n                       breaks = 2006:2021) +\n    scale_y_continuous(expand = expansion(),\n                       labels = label_percent(),\n                       breaks = c(0.4, 0.45, 0.5, 0.55, 0.6),\n                       limits = c(0.4, 0.6)) +\n    scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n    scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n    theme(legend.position = \"none\") +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Hlutfall stöðugilda Landspítala sem eru ekki hjúkrunarfræðingar, læknar eða sjúkraliðar\",\n         subtitle = \"Reiknað út frá starfsemisupplýsingum Landspítala um stöðugildi eftir stéttarfélögum\")\n\nggsave(plot = p +\n           scale_x_tufte(breaks = 2006:2021) +\n           scale_y_tufte(expand = expansion(),\n                              labels = label_percent(),\n                              limits = c(0.4, 0.6),\n                              breaks = c(range(plot_dat$hlutf_annad), 0.5, 0.45, 0.55, 0.6)) +\n           theme(plot.title = element_text(face = \"bold\")) +\n           labs(title =  \"Hlutfall stöðugilda Landspítala sem eru ekki hjúkrunarfræðingar, læknar eða sjúkraliðar\"), \n       filename = \"hlutf_ekki3.png\",\n       width = 8, height = 0.5 * 8, scale = 1.8,\n       bg = \"white\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n) |> \n    layout(hoverlabel = list(align = \"left\"))"
  },
  {
    "objectID": "posts/landspitali/index.html#stéttarfélög",
    "href": "posts/landspitali/index.html#stéttarfélög",
    "title": "Landspítalinn",
    "section": "Stéttarfélög",
    "text": "Stéttarfélög\nHér má sjá fjölda og hlutföll stöðugilda fyrir fleiri stéttarfélög. Þar sem Sameyki varð ekki til fyrr en 2019 lagði ég saman fjölda stöðugilda hjá viðeigandi stéttarfélögum fyrir þann tíma.\n\nHlutföllFjöldi\n\n\n\n\nCode\nplot_dat <- d |> \n    select(ar, stodugildi, starts_with(\"stg\"), -ends_with(\"svid\")) |> \n    drop_na() |> \n    pivot_longer(c(-ar, -stodugildi)) |> \n    group_by(ar) |> \n    mutate(annad = stodugildi - sum(value)) |> \n    pivot_wider(names_from = name, values_from = value) |> \n    pivot_longer(c(-ar, -stodugildi)) |> \n    mutate(name = fct_reorder(name, value * (name != \"annad\"))) |> \n    group_by(ar) |> \n    mutate(hlutf = value / sum(value)) |> \n    ungroup() |> \n    mutate(name = fct_recode(name,\n                             \"Annað\" = \"annad\",\n                             \"Hjúkrunarfræðingar\" = \"stg_hjukr\",\n                             \"Læknar\" = \"stg_laekna\",\n                             \"Sjúkraliðar\" = \"stg_sjukral\",\n                             \"Sameyki\" = \"stg_sameyki\",\n                             \"Sálfræðingar\" = \"stg_salfr\",\n                             \"Sjúkraþjálfarar\" = \"stg_sjukrathj\",\n                             \"Félagsráðgjafar\" = \"stg_felrad\",\n                             \"Lyfjafræðingar\" = \"stg_lyfjafr\",\n                             \"Iðjuþjálfar\" = \"stg_idjuthj\",\n                             \"Ljósmæður\" = \"stg_ljosmaedur\"),\n           text = str_c(\"<b>\", name, \"</b>\", \"\\n\",\n                        \"Ár: \", ar, \"\\n\",\n                        \"<b>Hlutfall: \", percent(hlutf, accuracy = 0.1, big.mark = \".\", decimal.mark = \",\"), \"</b>\\n\",\n                        \"Fjöldi: \", number(value, suffix = \" stöðugildi\", big.mark = \".\", decimal.mark = \",\"), \"\\n\"))\n\np <- plot_dat |> \n    ggplot(aes(ar, value, text = text)) +\n    geom_col(aes(fill = name, col = name), width = 1, position = \"fill\") +\n    scale_x_continuous(expand = expansion(),\n                       breaks = 2010:2021) +\n    scale_y_continuous(expand = expansion(),\n                       labels = label_percent()) +\n    scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n    scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n    theme(legend.position = \"none\") +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Dreifing stöðugilda á Landspítala eftir stéttarfélagi\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n) |> \n    layout(hoverlabel = list(align = \"left\"))\n\n\n\n\n\n\n\n\n\n\nCode\nplot_dat <- d |> \n    select(ar, stodugildi, starts_with(\"stg\"), -ends_with(\"svid\")) |> \n    drop_na() |> \n    pivot_longer(c(-ar, -stodugildi)) |> \n    group_by(ar) |> \n    mutate(annad = stodugildi - sum(value)) |> \n    pivot_wider(names_from = name, values_from = value) |> \n    pivot_longer(c(-ar, -stodugildi)) |> \n    mutate(name = fct_reorder(name, value * (name != \"annad\"))) |> \n    group_by(ar) |> \n    mutate(hlutf = value / sum(value)) |> \n    ungroup() |> \n    mutate(name = fct_recode(name,\n                             \"Annað\" = \"annad\",\n                             \"Hjúkrunarfræðingar\" = \"stg_hjukr\",\n                             \"Læknar\" = \"stg_laekna\",\n                             \"Sjúkraliðar\" = \"stg_sjukral\",\n                             \"Sameyki\" = \"stg_sameyki\",\n                             \"Sálfræðingar\" = \"stg_salfr\",\n                             \"Sjúkraþjálfarar\" = \"stg_sjukrathj\",\n                             \"Félagsráðgjafar\" = \"stg_felrad\",\n                             \"Lyfjafræðingar\" = \"stg_lyfjafr\",\n                             \"Iðjuþjálfar\" = \"stg_idjuthj\",\n                             \"Ljósmæður\" = \"stg_ljosmaedur\"),\n           text = str_c(\"<b>\", name, \"</b>\", \"\\n\",\n                        \"Ár: \", ar, \"\\n\",\n                        \"Hlutfall: \", percent(hlutf, accuracy = 0.1, big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                        \"<b>Fjöldi: \", number(value, suffix = \" stöðugildi\", big.mark = \".\", decimal.mark = \",\"), \"</b>\\n\"))\n\np <- plot_dat |> \n    ggplot(aes(ar, value, text = text)) +\n    geom_col(aes(fill = name, col = name), width = 1, position = \"stack\") +\n    scale_x_continuous(expand = expansion(),\n                       breaks = 2010:2021) +\n    scale_y_continuous(expand = expansion(),\n                       labels = label_number(big.mark = \".\", decimal.mark = \",\")) +\n    scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n    scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n    theme(legend.position = \"none\") +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Fjöldi stöðugilda á Landspítala eftir stéttarfélagi\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n) |> \n    layout(hoverlabel = list(align = \"left\"))"
  },
  {
    "objectID": "posts/landspitali/index.html#stoðþjónusta-yfirstjórnstjórnsýsla",
    "href": "posts/landspitali/index.html#stoðþjónusta-yfirstjórnstjórnsýsla",
    "title": "Landspítalinn",
    "section": "Stoðþjónusta (Yfirstjórn/stjórnsýsla)",
    "text": "Stoðþjónusta (Yfirstjórn/stjórnsýsla)\nTexti og gögn frá Spurt og svarað um Landspítala þar sem er m.a. vitnað í skýrslu McKinsey frá 2020.\n\nStjórnendur við Landspítala eru ríflega 200 talsins en starfsmenn um 6000 í rúmlega 4500 stöðugildum, að meðaltali einn stjórnandi á hverja 26 starfsmenn. Samkvæmt hinu erlenda ráðgjafarfyrirtæki McKinsey er „yfirstjórn/stjórnsýsla“ hlutfallslega minnst á Landspítala (13,2%) borið saman við Sjúkrahúsið á Akureyri (15,5%) og erlend samanburðarsjúkrahús (allt að 21,2%).\n\n\nÍ stoðþjónustu á Landspítala voru 602 stöðugildi árið 2020 sem gerir 13,5% af heildarfjölda stöðugilda það árið (4462 stg). Þetta er sambærilegt hlutfall og á Sjúkrahúsinu á Akureyri og einnig því samanburðarsjúkrahúsi sem valið var til samanburðar í skýrslu McKinsey frá árinu 2020.\n\n\nÞrátt fyrir að koma ekki beint að þjónustu við sjúklinga gegnir þetta starfsfólk engu að síður mikilvægu hlutverki. Þannig verður spítali ekki rekinn án fólks sem býr til mat handa sjúklingum, útvegar fatnað handa hjúkrunarfræðingum, reiknar laun handa sjúkraliðum, tæknifólks sem viðheldur öndunarvélum, forriturum sem passa upp á sjúkraskrár og svo framvegis. Þess má geta að á árunum eftir hrun var sérstaklega skorið niður í hópi þessara starfsmanna.\n\n\nÞannig var hlutfall starfsmanna í stoðþjónustu af heildarfjölda stöðugilda 16,3% árið 2008 en er sem fyrr segir 13,5% árið 2021. Það er sérstakt markmið stjórnenda Landspítala að fjölga starfsfólki í stoðþjónustu svo faglært starfsfólk geti einbeitt sér að beinni þjónustu við sjúklinga og starfað í samræmi við menntun sína (e. Working from the top of your licence).\n\n\nHlutfallFjöldi\n\n\n\n\nCode\nplot_dat <- d |> \n    select(ar, hlutf_stodtj, stodugildi) |> \n    drop_na() |> \n    mutate(text = str_c(\"Ár: \", ar, \"\\n\",\n                        \"<b>Hlutfall: \", percent(hlutf_stodtj, accuracy = 0.1, big.mark = \".\", decimal.mark = \",\"), \"</b>\\n\",\n                        \"Fjöldi: \", number(hlutf_stodtj * stodugildi, suffix = \" stöðugildi\", big.mark = \".\", decimal.mark = \",\"), \"\\n\")) |> \n    drop_na()\n\np <- plot_dat |> \n    ggplot(aes(ar, hlutf_stodtj, text = text)) +\n    geom_line(aes(group = \"none\"), alpha = 0.6, col = \"black\") +\n    scale_x_continuous(expand = expansion(add = 0.6),\n                       breaks = 2006:2021) +\n    scale_y_continuous(expand = expansion(),\n                       labels = label_percent(),\n                       breaks = seq(0, 0.2, by = 0.02),\n                       limits = c(0.1, 0.2)) +\n    scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n    scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n    theme(legend.position = \"none\") +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Hlutfall stoðþjónustu af stöðugildum Landspítala\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n) |> \n    layout(hoverlabel = list(align = \"left\"))\n\n\n\n\n\n\n\n\n\n\nCode\nplot_dat <- d |> \n    select(ar, hlutf_stodtj, stodugildi) |> \n    drop_na() |> \n    mutate(fjoldi = hlutf_stodtj * stodugildi,\n           text = str_c(\"Ár: \", ar, \"\\n\",\n                        \"Hlutfall: \", percent(hlutf_stodtj, accuracy = 0.1, big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                        \"<b>Fjöldi: \", number(fjoldi, suffix = \" stöðugildi\", big.mark = \".\", decimal.mark = \",\"), \"</b>\")) |> \n    drop_na()\n\np <- plot_dat |> \n    ggplot(aes(ar, fjoldi, text = text)) +\n    geom_area(aes(group = \"none\"), alpha = 0.6, col = \"black\") +\n    scale_x_continuous(expand = expansion(add = 0.6),\n                       breaks = 2006:2021) +\n    scale_y_continuous(expand = expansion(),\n                       labels = label_number(),\n                       limits = c(0, NA)) +\n    scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n    scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n    theme_half_open() +\n    theme(legend.position = \"none\") +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Fjöldi stöðugilda stoðþjónustu á Landspítala (2008 - 2020)\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n) |> \n    layout(hoverlabel = list(align = \"left\"))"
  },
  {
    "objectID": "posts/landspitali/index.html#stjórnendur",
    "href": "posts/landspitali/index.html#stjórnendur",
    "title": "Landspítalinn",
    "section": "Stjórnendur",
    "text": "Stjórnendur\nFyrir tæpu ári síðan birti Landspítali Samantekt um stjórnendur á Landspítala og laun þeirra. Þar getum við séð hlutfall stjórnenda af öllum stöðugildum og notað svo gögnin um heildarfjölda stöðugilda til að reikna fjölda stöðugilda stjórnenda. Eins og sést að neðan hefur hlutfallið farið stöðugt lækkandi frá 2008 til 2020, og fjöldi stöðugilda stjórnenda lækkað eða haldist í stað.\n\nHlutfallFjöldi\n\n\n\n\nCode\nplot_dat <- d |> \n    select(ar, hlutf_stjornendur, stodugildi) |> \n    drop_na() |> \n    mutate(text = str_c(\"Ár: \", ar, \"\\n\",\n                        \"<b>Hlutfall: \", percent(hlutf_stjornendur, accuracy = 0.1, big.mark = \".\", decimal.mark = \",\"), \"</b>\\n\",\n                        \"Fjöldi: \", number(hlutf_stjornendur * stodugildi, suffix = \" stöðugildi\", big.mark = \".\", decimal.mark = \",\"), \"\\n\")) |> \n    drop_na()\n\np <- plot_dat |> \n    ggplot(aes(ar, hlutf_stjornendur, text = text)) +\n    geom_line(aes(group = \"none\"), alpha = 0.6, col = \"black\") +\n    scale_x_continuous(expand = expansion(add = 0.6),\n                       breaks = 2006:2021) +\n    scale_y_continuous(expand = expansion(),\n                       labels = label_percent(),\n                       breaks = 0:10/100,\n                       limits = c(0.02, 0.07)) +\n    scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n    scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n    theme(legend.position = \"none\") +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Hlutfall stjórnenda af stöðugildum Landspítala\",\n         subtitle = \"Árið 2008 voru stjórnendur 5,9% af stöðugildum en 4,7% árið 2020.\")\n\nggsave(plot = p +\n           geom_rangeframe() +\n           theme_tufte() +\n           scale_y_continuous(expand = expansion(),\n                              labels = label_percent(accuracy = 0.1),\n                              limits = c(0.03, 0.07),\n                              breaks = c(range(plot_dat$hlutf_stjornendur), \n                                         0, 0.03, 0.04, 0.05, 0.055, 0.07)) +\n           theme(plot.title = element_text(face = \"bold\")), \n       filename = \"hlutf_stjornendur.png\",\n       width = 8, height = 0.5 * 8, scale = 1.5,\n       bg = \"white\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n) |> \n    layout(hoverlabel = list(align = \"left\"))\n\n\n\n\n\n\n\n\n\n\nCode\nplot_dat <- d |> \n    select(ar, hlutf_stjornendur, stodugildi) |> \n    drop_na() |> \n    mutate(fjoldi = hlutf_stjornendur * stodugildi,\n           text = str_c(\"Ár: \", ar, \"\\n\",\n                        \"Hlutfall: \", percent(hlutf_stjornendur, accuracy = 0.1, big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                        \"<b>Fjöldi: \", number(fjoldi, suffix = \" stöðugildi\", big.mark = \".\", decimal.mark = \",\"), \"</b>\")) |> \n    drop_na()\n\np <- plot_dat |> \n    ggplot(aes(ar, fjoldi, text = text)) +\n    geom_area(aes(group = \"none\"), alpha = 0.6, col = \"black\") +\n    scale_x_continuous(expand = expansion(add = 0.6),\n                       breaks = 2006:2021) +\n    scale_y_continuous(expand = expansion(),\n                       labels = label_number(),\n                       limits = c(0, NA)) +\n    scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n    scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n    theme(legend.position = \"none\") +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Fjöldi stöðugilda stjórnenda á Landspítala\",\n         subtitle = \"Árið 2008 voru stöðugildi stjórnenda 229,2 en voru 208,3 árið 2020\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n) |> \n    layout(hoverlabel = list(align = \"left\"))"
  },
  {
    "objectID": "posts/landspitali/index.html#skrifstofa",
    "href": "posts/landspitali/index.html#skrifstofa",
    "title": "Landspítalinn",
    "section": "Skrifstofa",
    "text": "Skrifstofa\nFyrir nokkrum árum endurskilgreindi Landspítali starfsemissviðin sín og tók að nota færri yfirsvið í starfsemisupplýsingum sínum. Í starfemisupplýsingum má sjá að stöðugildum hefur fjölgað á Skrifstofusviði, en þessi fjölgun þýðir ekki að skrifstofufólki hefur fjölgað heldur hefur verið að færa starfsemi á milli sviða. Ég bendi áhugasömum á Spurt og svarað um Landspítala.\n\n\nCode\nknitr::include_graphics(\"skrifstof_landsp.png\")\n\n\n\n\n\nTilkynning vegna skrifstofustöðugilda"
  },
  {
    "objectID": "posts/landspitali/index.html#á-höfðatölu",
    "href": "posts/landspitali/index.html#á-höfðatölu",
    "title": "Landspítalinn",
    "section": "Á höfðatölu",
    "text": "Á höfðatölu\n\n\nCode\nd <- read_csv(\"data.csv\") |> \n    mutate(text = str_c(\"Ár: \", ar, \"\\n\",\n                        \"Launaútgjöld: \", number(laun, suffix = \" kr\", big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                        \"Mannfjöldi (heild): \", number(pop, big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                        \"Mannfjöldi (65+): \", number(pop_65, big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                        \"Laun per íbúi (heild): \", number(laun_per_pers, suffix = \" kr\", big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                        \"Laun per íbúi (65+): \", number(laun_per_pers_65, suffix = \" kr\", big.mark = \".\", decimal.mark = \",\")))\n\n\nVið getum svo notað tölur Hagstofu um mannfjölda eftir aldri til að reikna launaútgjöld á höfðatölu, bæði fyrir alla íbúa og fyrir íbúa sem hafa náð 65 ára aldri.\nUpphæðirnar að neðan eru leiðréttar fyrir verðbólgu með vísitölu neysluverðs.\n\nAllir65+\n\n\nEf við skoðum launaútgjöld á hvern íbúa sýnist okkur að launaútgjöldin hafa aldrei verið hærri.\n\n\nCode\np <- d |> \n    ggplot(aes(x = ar, y = laun_per_pers, text = text)) +\n    geom_area(aes(group = \"none\"), alpha = 0.6, col = \"black\") +\n    scale_x_continuous(breaks = seq(1999, 2021, by = 2)) +\n    scale_y_continuous(labels = label_number(suffix = \" kr\", \n                                             big.mark = \".\", decimal.mark = \",\"),\n                       expand = expansion()) +\n    coord_cartesian(ylim = c(0, NA)) +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Launaútgjöld til Landspítala á íbúa\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n)\n\n\n\n\n\n\n\n\nEn þegar við skoðum launaútgjöld á hvern íbúa sem hefur náð 65 ára aldri eru við rétt að komast upp í sömu fjárhæð og árið 2007.\n\n\nCode\np <- d |> \n    ggplot(aes(x = ar, y = laun_per_pers_65, text = text)) +\n    geom_area(aes(group = \"none\"), alpha = 0.6, col = \"black\") +\n    scale_x_continuous(breaks = seq(1999, 2021, by = 2)) +\n    scale_y_continuous(labels = label_number(suffix = \" kr\", \n                                             big.mark = \".\", decimal.mark = \",\"),\n                       expand = expansion()) +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Launaútgjöld til Landspítala á 65+ ára íbúa\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n)"
  },
  {
    "objectID": "posts/skattagogn/index.html",
    "href": "posts/skattagogn/index.html",
    "title": "Tekjur, skattar og kaupmáttur",
    "section": "",
    "text": "Code\nplot_dat <- d |> \n    filter(tiundarbreyta == \"Heildartekjur\",\n           name %in% c(\"Tekjur alls\", \"Fjöldi í hóp\"),\n           ar == 2021) |> \n    collect() |> \n    pivot_wider(names_from = name, values_from = value) |> \n    janitor::clean_names()\n\nfjoldi <- number(sum(plot_dat$fjoldi_i_hop), big.mark = \".\", decimal.mark = \",\")\ntekjur <- number(sum(plot_dat$tekjur_alls), big.mark = \".\", decimal.mark = \",\")\ntekjur_a_mann <- number(sum(plot_dat$tekjur_alls) / sum(plot_dat$fjoldi_i_hop), acrucay = 0.1, big.mark = \".\", decimal.mark = \",\")\ntekjur_a_mann_a_manudi <- number(sum(plot_dat$tekjur_alls) / sum(plot_dat$fjoldi_i_hop) / 12, accuracy = 0.1, big.mark = \".\", decimal.mark = \",\")\n\n\nÞað er fátt jafn sexý og þegar einhver talar um tekjutíundir, en hvað þýðir það? Í gögnum Hagstofunnar um tekjur eru samtals 230.401 einstaklingar og þau fengu samtals tekjur upp á 2.182.908 milljónir króna, eða 9 milljónir króna á mann á ári (0,8 milljónir á mánuði).\nEn þessir einstaklingar höfðu ekki allir sömu tekjur, heldur er tekjum dreift ójafnt. Sum hafa hærri tekjur og aðrir lægri. Ímyndum að við tökum þessa 230.401 einstaklinga, röðum þeim í vaxandi röð eftir tekjum þeirra og skiptum svo í tíu jafnstóra hópa. Þá erum við komin með það sem kallast tekjutíundir! Í töflu I að neðan sjáum við hvernig heildartekjur skiptust í tekjutíundir árið 2021.\nHér ber að hafa í huga að allir einstaklingar sem náð hafa 16 ára aldri teljast með í þessum gögnum. Því þýða mánaðartekjur upp á 37 þúsund kr í lægstu tíundinni ekki að fjölskyldur þurfi að lifa á þeim tekjum, heldur eru þarna margir einstaklingar með engar eða mjög litlar tekjur.\n\n\nCode\nplot_dat |> \n    mutate(\n        p = tekjur_alls / sum(tekjur_alls),\n        p = percent(p, decimal.mark = \",\", big.mark = \".\"),\n        tekjur_a_mann = tekjur_alls / fjoldi_i_hop * 1e6 / 12,\n        tekjur_a_mann = number(\n            tekjur_a_mann, suffix = \" kr\", decimal.mark = \",\", big.mark = \".\"\n        ),\n        tekjur_a_mann = ifelse(\n            tiundarhluti == 1, \n            str_c(\n                tekjur_a_mann, \n                footnote_marker_alphabet(1, format = \"html\")\n            ),\n            tekjur_a_mann\n        ),\n        tekjur_alls = number(\n            tekjur_alls, suffix = \" mkr\", decimal.mark = \",\", big.mark = \".\"\n        )\n    ) |> \n    select(tiundarhluti, tekjur_a_mann, tekjur_alls, p) |> \n    kable(\n        format = \"html\",\n        col.names = c(\"Tekjutíund\", \"Tekjur á mann<br>(á mánuði)\", \"Tekjur alls\", \"Hlutfall allra tekna\"), \n        escape = FALSE, \n        align = c(\"c\", \"c\", \"c\", \"c\"),\n        caption = \"Tafla I. Skipting heildartekna á tekjutíundir árið 2021\"\n    ) |> \n    kable_styling(bootstrap_options = c(\"striped\", \"hover\"), full_width = FALSE) |> \n    footnote(alphabet = c(\"Einstaklingar á aldrinum 16-17 hafa oft engar eða litlar tekjur meirihluta árs.\"), fixed_small_size = T)\n\n\n\n\nTafla I. Skipting heildartekna á tekjutíundir árið 2021\n \n  \n    Tekjutíund \n    Tekjur á mann(á mánuði) \n    Tekjur alls \n    Hlutfall allra tekna \n  \n \n\n  \n    1 \n    37.203 kra \n    10.286 mkr \n    0,5% \n  \n  \n    2 \n    169.083 kr \n    46.748 mkr \n    2,1% \n  \n  \n    3 \n    303.747 kr \n    83.980 mkr \n    3,8% \n  \n  \n    4 \n    402.825 kr \n    111.373 mkr \n    5,1% \n  \n  \n    5 \n    490.488 kr \n    135.610 mkr \n    6,2% \n  \n  \n    6 \n    614.343 kr \n    169.861 mkr \n    7,8% \n  \n  \n    7 \n    780.465 kr \n    215.783 mkr \n    9,9% \n  \n  \n    8 \n    1.011.961 kr \n    279.787 mkr \n    12,8% \n  \n  \n    9 \n    1.370.797 kr \n    378.998 mkr \n    17,4% \n  \n  \n    10 \n    2.714.417 kr \n    750.482 mkr \n    34,4% \n  \n\n\na Einstaklingar á aldrinum 16-17 hafa oft engar eða litlar tekjur meirihluta árs.\n\n\n\n\nVið getum skipt öðrum breytum en tekjum í tíundir. Í mælaborðinu mínu um skattahögn Hagstofunnar er hægt að skoða ýmsar breytur eftir tíundum heildartekna, ráðstöfunartekna, eigna og annarra breytna!"
  },
  {
    "objectID": "posts/skattagogn/index.html#hversu-hátt-hlutfall-af-öllum-sköttum-borgar-hver-tekjuhópur",
    "href": "posts/skattagogn/index.html#hversu-hátt-hlutfall-af-öllum-sköttum-borgar-hver-tekjuhópur",
    "title": "Tekjur, skattar og kaupmáttur",
    "section": "Hversu hátt hlutfall af öllum sköttum borgar hver tekjuhópur?",
    "text": "Hversu hátt hlutfall af öllum sköttum borgar hver tekjuhópur?\nÞað ætti ekki að koma á óvart að efri tekjutíundir borgi hærra hlutfall af öllum sköttum heldur en lægri tíundir. Fjármálaráðuneytið benti á það í tilkynningu þann 23. júní 2021 að efstu fimm tekjutíundirnar borgi 83% af öllum sköttum. Er þetta eftirtektarvert? Út frá töflunni okkar að ofan getum við séð að efstu fimm tíundirnar fá\n\\[\n34.4\\% + 17.4\\% + 12.8\\% + 9.9\\% + 7.8\\% = 82.3\\%\n\\]\naf öllum tekjum, og því ætti það alls ekki að koma okkur á óvart að þau borgi það hátt hlutfall af öllum sköttum. Þessi tala, 83%, þýðir því ekki að það sé vegið að þeim tekuhærri á óréttlátan hátt.\nEn hvað borgar hver tekjutíund mikið í skatta og hvernig ber því saman við heildartekjur þeirra? Á myndinni að neðan ber ég þetta tvennt saman. Hægt er að smella á Play til að sjá þróunina frá 1997 til 2021 eða velja ár til að skoða. Ef allir tekjuhópar borguðu jafnt hlutfall í skatta væru allir punktarnir á brotnu línunni.\n\n\nCode\nplot_dat <- d |>\n    filter(tiundarbreyta %in% \"Heildartekjur\",\n           name %in% c(\"Tekjur alls\", \n                       \"Ráðstöfunartekjur (Tekjur - Skattar)\",\n                       \"Fjöldi í hóp\")) |> \n    collect() |> \n    pivot_wider() |> \n    rename(fjoldi = \"Fjöldi í hóp\") |> \n    mutate(`Skattar alls` = `Tekjur alls` - `Ráðstöfunartekjur (Tekjur - Skattar)`) |> \n    select(-\"Ráðstöfunartekjur (Tekjur - Skattar)\") |> \n    pivot_longer(c(-ar, -tiundarbreyta, -tiundarhluti, -fjoldi)) |> \n    group_by(ar, name) |> \n    mutate(p = value / sum(value)) |> \n    ungroup()\n\n\nplot_dat <- plot_dat |> \n    select(-tiundarbreyta, -value) |> \n    pivot_wider(names_from = name, values_from = p) |> \n    janitor::clean_names() |> \n    rename(tekjur_hlutf = tekjur_alls, skattar_hlutf = skattar_alls) |> \n    inner_join(\n        plot_dat |> \n            select(-tiundarbreyta, -p) |> \n            pivot_wider(names_from = name, values_from = value) |> \n            janitor::clean_names(),\n        by = c(\"ar\", \"tiundarhluti\", \"fjoldi\")\n    ) |> \n    inner_join(\n        vnv() |> \n            group_by(ar = year(date)) |> \n            summarise(visitala = mean(cpi),\n                      .groups = \"drop\") |> \n            mutate(visitala = visitala / visitala[ar == max(ar)]),\n        by = \"ar\"\n    ) |> \n    mutate(tekjur_alls = tekjur_alls / visitala,\n           skattar_alls = skattar_alls / visitala,\n           skattar_hlutf_tekjum = skattar_alls / tekjur_alls) |> \n    mutate(text = str_c(\"<b>Tekjutíund: \", tiundarhluti, \"</b>\", \"\\n\",\n                        \"Ár: \", ar, \"\\n\",\n                        \"Tekjur (á mann á mánuði): \", number(tekjur_alls * 1e6 / (fjoldi * 12), suffix = \" kr\", big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                        \"% allra tekna: \", percent(tekjur_hlutf, accuracy = 0.1), \"\\n\",\n                        \"Skattar (á mann á mánuði): \", number(skattar_alls * 1e6 / (fjoldi * 12), suffix = \" kr\", big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                        \"% allra skatta: \", percent(skattar_hlutf, accuracy = 0.1), \"\\n\",\n                        \"Skattbyrði (% af tekjum): \", percent(skattar_hlutf_tekjum, accuracy = 0.1)))\n\n\n\np <- plot_dat |> \n    ggplot(aes(tekjur_hlutf, skattar_hlutf, \n               frame = ar, text = text)) +\n    geom_abline(intercept = 0, slope = 1, lty = 2) +\n    geom_point() +\n    scale_x_continuous(labels = label_percent(),\n                       expand = expansion(),\n                       limits = c(min(plot_dat$skattar_hlutf), 0.5),\n                       breaks = seq(0, 50, by = 10)/100) +\n    scale_y_continuous(labels = label_percent(),\n                       expand = expansion(),\n                       limits = c(min(plot_dat$skattar_hlutf), 0.5),\n                       breaks = seq(0, 50, by = 10)/100) +\n    theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 5)) +\n    labs(x = \"% af öllum tekjum\",\n         y = \"% af öllum sköttum\",\n         title = \"Hvað fær hver tekjutíund háa % af öllum tekjum og sköttum?\")\n\n\nggplotly(\n    p,\n    tooltip = \"text\"\n) |> \n    animation_opts(\n        transition = 500,\n        redraw = FALSE\n        \n    ) |> \n    animation_slider(currentvalue = list(prefix = \"Ár:\")) |> \n    layout(\n        hoverlabel = list(align = \"left\")\n    )"
  },
  {
    "objectID": "posts/skattagogn/index.html#skattbyrði",
    "href": "posts/skattagogn/index.html#skattbyrði",
    "title": "Tekjur, skattar og kaupmáttur",
    "section": "Skattbyrði",
    "text": "Skattbyrði\nVið getum líka skoðað skattbyrði, eða hversu hátt hlutfall af tekjum sínum hver hópur borgar í skatta. Eins og að ofan er hægt að smella á Play til að sjá þróunina frá 1997 til 2021 eða velja ár sjálf til að skoða. Í sömu tilkynningu frá fjármálaráðuneytinu og ég nefndi að ofan var bent á að skattbyrði allra tekjutíunda nema þeirri efstu hefði lækkað frá 2019 til 2021. Það er rétt, en það er gott að hafa í huga að skattbyrði sömu tíunda hækkaði flestöll árin frá 1997 til 2019.\nNeðar í færslunni mun ég svo sýna hvernig skattbyrði hefur hækkað síðan 1997 hjá öllum tekjutíundum nema þeirri efstu.\n\n\nCode\nplot_dat <- plot_dat |> \n    mutate(\n        text = str_c(\"<b>Tekjutíund: \", tiundarhluti, \"</b>\", \"\\n\",\n                     \"Ár: \", ar, \"\\n\",\n                     \"Tekjur (á mann á mánuði): \", number(tekjur_alls * 1e6 / (fjoldi * 12), suffix = \" kr\", big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                     \"% allra tekna: \", percent(tekjur_hlutf, accuracy = 0.1), \"\\n\",\n                     \"Skattar (á mann á mánuði): \", number(skattar_alls * 1e6 / (fjoldi * 12), suffix = \" kr\", big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                     \"% allra skatta: \", percent(skattar_hlutf, accuracy = 0.1), \"\\n\",\n                     \"<b>Skattbyrði (% af tekjum): \", percent(skattar_hlutf_tekjum, accuracy = 0.1), \"</b>\")\n    )\np <- plot_dat |> \n    ggplot(aes(tiundarhluti, skattar_hlutf_tekjum, \n               frame = ar, text = text)) +\n    geom_line(aes(group = \"none\")) +\n    geom_point() +\n    scale_x_continuous(expand = expansion(add = 0.05),\n                       breaks = seq(0, 10, by = 1)) +\n    scale_y_continuous(labels = label_percent(),\n                       expand = expansion(add = 0.002),\n                       breaks = seq(0, 50, by = 10)/100) +\n    theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 5)) +\n    labs(x = \"Tekjutíund\",\n         y = \"Skattbyrðu (Skattar sem % af tekjum)\",\n         title = \"Skattbyrði eftir tekjutíund\")\n\n\nggplotly(\n    p,\n    tooltip = \"text\"\n) |> \n    animation_opts(\n        transition = 500,\n        redraw = FALSE\n        \n    ) |> \n    animation_slider(currentvalue = list(prefix = \"Ár:\")) |> \n    layout(\n        hoverlabel = list(align = \"left\")\n    )"
  },
  {
    "objectID": "posts/skattagogn/index.html#kaupmáttur-heildartekna",
    "href": "posts/skattagogn/index.html#kaupmáttur-heildartekna",
    "title": "Tekjur, skattar og kaupmáttur",
    "section": "Kaupmáttur heildartekna",
    "text": "Kaupmáttur heildartekna\nKaupmáttur er einfaldlega hækkun á tekjum umfram verðbólgu (hækkun á verðlagi, mælt með vísitölu neysluverðs). Hér sjáum við hækkun kaupmáttar frá 1997 hjá meðaleinstakling úr hverru tekjutíund.\n\n\nCode\nplot_dat <- d |> \n    filter(tiundarbreyta == \"Heildartekjur\",\n           name %in% c(\"Tekjur alls\", \"Fjöldi í hóp\")) |> \n    collect() |> \n    pivot_wider() |> \n    rename(fjoldi = \"Fjöldi í hóp\") |> \n    pivot_longer(c(-ar, -tiundarbreyta, -tiundarhluti, -fjoldi)) |> \n    group_by(ar, name) |> \n    mutate(p = value / sum(value)) |> \n    ungroup() |> \n    select(-tiundarbreyta) |> \n    inner_join(\n        vnv() |> \n            group_by(ar = year(date)) |> \n            summarise(cpi = mean(cpi),\n                      .groups = \"drop\") |> \n            mutate(cpi = cpi / cpi[ar == max(ar)]),\n        by = \"ar\"\n    ) |> \n    mutate(\n        value = (value / fjoldi) / cpi,\n        index = value / value[ar == min(ar)],\n        text = str_c(\"<b>Tekjutíund: \", tiundarhluti, \"</b>\", \"\\n\",\n                     \"Ár: \", ar, \"\\n\",\n                     \"Heildartekjur (á mann á mánuði): \",\n                     number(value * 1e6 / 12, suffix = \" kr\", big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                     \"Breyting (síðan 1997): \", \n                     ifelse(index >= 1, \"+\", \"\"),\n                     percent(index - 1, accuracy = 0.01, big.mark = \".\", decimal.mark = \",\")\n        )\n    )\n\np <- plot_dat |> \n    ggplot(aes(ar, index, text = text)) +\n    geom_hline(yintercept = 1, lty = 2) +\n    geom_line(aes(group = tiundarhluti, col = tiundarhluti)) +\n    scale_x_continuous() +\n    scale_y_log10(\n        labels = function(x) percent(x - 1),\n        breaks = c(\n            1, 1.25, 1.5, 2, 3,\n            1/1.25, 1/1.5, 1/2, 1/3\n        )\n    ) +\n    scale_colour_distiller(type = \"div\", palette = \"RdYlBu\", direction = 1) +\n    theme(legend.position = \"none\") +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Breyting á kaupmætti heildartekna frá 1997\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n) |> \n    layout(\n        hoverlabel = list(align = \"left\")\n    )"
  },
  {
    "objectID": "posts/skattagogn/index.html#kaupmáttur-ráðstöfunartekna",
    "href": "posts/skattagogn/index.html#kaupmáttur-ráðstöfunartekna",
    "title": "Tekjur, skattar og kaupmáttur",
    "section": "Kaupmáttur ráðstöfunartekna",
    "text": "Kaupmáttur ráðstöfunartekna\nVið höfum frekar áhuga á kaupmætti ráðstöfunartekna (heildartekjur að frádegnum sköttum).\n\n\nCode\nplot_dat <- d |> \n    filter(tiundarbreyta == \"Ráðstöfunartekjur\",\n           name %in% c(\"Ráðstöfunartekjur (Tekjur - Skattar)\", \"Fjöldi í hóp\")) |> \n    collect() |> \n    pivot_wider() |> \n    rename(fjoldi = \"Fjöldi í hóp\") |> \n    pivot_longer(c(-ar, -tiundarbreyta, -tiundarhluti, -fjoldi)) |> \n    group_by(ar, name) |> \n    mutate(p = value / sum(value)) |> \n    ungroup() |> \n    select(-tiundarbreyta) |> \n    inner_join(\n        vnv() |> \n            group_by(ar = year(date)) |> \n            summarise(cpi = mean(cpi),\n                      .groups = \"drop\") |> \n            mutate(cpi = cpi / cpi[ar == max(ar)]),\n        by = \"ar\"\n    ) |> \n    mutate(\n        value = (value / fjoldi) / cpi,\n        index = value / value[ar == min(ar)],\n        text = str_c(\"<b>Tekjutíund: \", tiundarhluti, \"</b>\", \"\\n\",\n                     \"Ár: \", ar, \"\\n\",\n                     \"Ráðstöfunartekjur (á mann á mánuði): \", \n                     number(value * 1e6 / 12, suffix = \" kr\", big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                     \"Breyting (síðan 1997): \", \n                     ifelse(index >= 1, \"+\", \"\"),\n                     percent(index - 1, accuracy = 0.01, big.mark = \".\", decimal.mark = \",\")\n        )\n    )\n\np <- plot_dat |> \n    ggplot(aes(ar, index, text = text)) +\n    geom_hline(yintercept = 1, lty = 2) +\n    geom_line(aes(group = tiundarhluti, col = tiundarhluti)) +\n    scale_x_continuous() +\n    scale_y_log10(\n        labels = function(x) percent(x - 1),\n        breaks = c(\n            1, 1.25, 1.5, 2, 3,\n            1/1.25, 1/1.5, 1/2, 1/3\n        )\n    ) +\n    scale_colour_distiller(type = \"div\", palette = \"RdYlBu\", direction = 1) +\n    theme(legend.position = \"none\") +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Breyting á kaupmætti ráðstöfunartekna frá 1997\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n) |> \n    layout(\n        hoverlabel = list(align = \"left\")\n    )"
  },
  {
    "objectID": "posts/skattagogn/index.html#skattbyrði-1",
    "href": "posts/skattagogn/index.html#skattbyrði-1",
    "title": "Tekjur, skattar og kaupmáttur",
    "section": "Skattbyrði",
    "text": "Skattbyrði\nÞað er líka áhugavert að skoða breytingu í skattbyrði milli 1997 og 2021. Hér þýðir jákvæð prósenta að skattbyrði hefur aukist, en neikvæð prósenta að hún sé minni. Við sjáum að skattbyrði hefur aukist hjá öllum tekjutíundunum nema þeirri efstu. Hér erum við að skoða skattbyrði hvers hóps í heild sinni, þannig að það getur alltaf verið að þetta passi ekki við hvern og einn einstakling, heldur á þetta við um meðaltal allra einstaklinganna.\n\n\nCode\nplot_dat <- d |>\n    filter(tiundarbreyta %in% \"Heildartekjur\",\n           name %in% c(\"Tekjur alls\", \n                       \"Ráðstöfunartekjur (Tekjur - Skattar)\",\n                       \"Fjöldi í hóp\")) |> \n    collect() |> \n    pivot_wider() |> \n    rename(fjoldi = \"Fjöldi í hóp\") |> \n    mutate(`Skattar alls` = `Tekjur alls` - `Ráðstöfunartekjur (Tekjur - Skattar)`) |> \n    select(-\"Ráðstöfunartekjur (Tekjur - Skattar)\") |> \n    janitor::clean_names() |> \n    mutate(\n        value = skattar_alls / tekjur_alls,\n        index = value - value[ar == min(ar)],\n        text = str_c(\"<b>Tekjutíund: \", tiundarhluti, \"</b>\", \"\\n\",\n                     \"Ár: \", ar, \"\\n\",\n                     \"Skattbyrði: \", \n                     percent(value, accuracy = 0.01, big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                     \"Breyting (síðan 1997): \", \n                     ifelse(index >= 0, \"+\", \"\"),\n                     percent(index, accuracy = 0.01, big.mark = \".\", decimal.mark = \",\", suffix = \"%-stig\")\n        )\n    )\n\np <- plot_dat |> \n    ggplot(aes(ar, index, text = text)) +\n    geom_hline(yintercept = 0, lty = 2) +\n    geom_line(aes(group = tiundarhluti, col = tiundarhluti)) +\n    scale_x_continuous() +\n    scale_y_continuous(\n        labels = label_percent(suffix = \"%-stig\")\n    ) +\n    scale_colour_distiller(type = \"div\", palette = \"RdYlBu\", direction = 1) +\n    theme(legend.position = \"none\") +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Breyting á skattbyrði miðað við 1997\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n) |> \n    layout(\n        hoverlabel = list(align = \"left\")\n    )"
  },
  {
    "objectID": "posts/vinnuafl/index.html",
    "href": "posts/vinnuafl/index.html",
    "title": "Vinnumarkaður",
    "section": "",
    "text": "Fjöldi starfandi\n\nAlmennur vinnumarkaðurOpinber vinnumarkaðurSaman\n\n\n\n\nCode\nplot_dat <-  d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |>  \n    filter(year(dags) >= 2008)\n\np <- plot_dat |> \n    ggplot(aes(dags, Annad)) +  \n    geom_line() +  \n    scale_x_date(date_breaks = \"1 year\", date_labels = \"%Y\",   \n                 expand = expansion()) +  \n    scale_y_tufte(breaks = tufte_breaks(plot_dat$Annad),\n                  limits = c(1e5, 1.5e5),\n                  labels = label_number()) +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Fjöldi starfandi á almennum vinnumarkaði\") +\n    theme(plot.margin = margin(t = 5, r = 20, b = 5, l = 5))\n\np\n\n\n\n\n\n\n\n\n\nCode\nplot_dat <-  d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n)\n\np <- plot_dat |> \n    ggplot(aes(dags, Opinbert)) +  \n    geom_line() +  \n    scale_x_date(date_breaks = \"1 year\", date_labels = \"%Y\",   \n                 expand = expansion()) +  \n    scale_y_tufte(breaks = tufte_breaks(plot_dat$Opinbert),\n                  labels = label_number()) +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Fjöldi opinbers starfsfólks\") +\n    theme(plot.margin = margin(t = 5, r = 20, b = 5, l = 5))\n\np\n\n\n\n\n\n\n\n\n\nCode\nplot_dat <-  d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    mutate(tegund = fct_recode(as_factor(tegund),\n                               \"Opinber\" = \"Opinbert\",\n                               \"Almennur\" = \"Annad\"))\n\np <- plot_dat |> \n    ggplot(aes(dags, n)) +  \n    geom_line(aes(col = tegund)) +\n    geom_text(data = plot_dat |> filter(dags == max(dags)),\n              aes(label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n    scale_x_date(date_breaks = \"year\", date_labels = \"%Y\",  \n                 expand = expansion(add = 31),\n                 limits = c(min(plot_dat$dags), max(plot_dat$dags) + 15)) +  \n    scale_y_tufte(breaks = tufte_breaks(plot_dat$n),\n                  labels = label_number(),\n                  limits = c(0, 1.5e5),\n                  expand = expansion()) +\n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Fjöldi starfandi á almennum og opinberum vinnumarkaði\") +\n    theme(plot.margin = margin(t = 5, r = 60, b = 5, l = 5),\n          legend.position = \"none\")\n\np\n\n\n\n\n\n\n\n\n\n\nFjöldi miðað við fyrri ár\n\nAlmennurHlutfall Opinbert\n\n\n\n20172019\n\n\n\n\nCode\nplot_dat <- d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |>  \n    filter(year(dags) >= 2017) |>  \n    mutate(manudur = month(dags)) |>  \n    group_by(manudur) |>  \n    mutate(breyting = Annad - Annad[year(dags) == min(year(dags))]) |> \n    ungroup()\n\np <- plot_dat |> \n    ggplot(aes(dags, breyting)) +  \n    geom_vline(xintercept = ymd(c(\"2018-01-01\", \"2019-01-01\", \"2020-01-01\", \"2021-01-01\", \"2022-01-01\")), lty = 2, alpha = 0.3) +\n    geom_hline(yintercept = 0, lty = 2) +  \n    geom_line() +  \n    scale_x_date(date_breaks = \"3 months\", date_labels = \"%b/%y\",  \n                 guide = guide_axis(n.dodge = 2),  \n                 expand = expansion()) +  \n    scale_y_tufte(breaks = tufte_breaks(plot_dat$breyting),\n                  labels = label_number(),\n                  limits = c(-1.8e4, 1e4)) +  \n    labs(x = NULL, y = NULL,  \n         title = \"Fjöldi starfandi á almennum vinnumarkaði miðað við sama mánuð 2017\",\n         subtitle = \"Janúar 2022 var fyrsti mánuður frá upphafi faraldurs COVID-19 þar sem fleiri unnu á almennum markaði en sama mánuð 2017\") +  \n    theme(plot.margin = margin(t = 5, r = 20, b = 5, l = 5))\n\np\n\n\n\n\n\n\n\n\n\nCode\nplot_dat <- d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |>  \n    filter(year(dags) >= 2019) |>  \n    mutate(manudur = month(dags)) |>  \n    group_by(manudur) |>  \n    mutate(breyting = Annad - Annad[year(dags) == min(year(dags))]) |> \n    ungroup()\n\np <- plot_dat |> \n    ggplot(aes(dags, breyting)) +  \n    geom_vline(xintercept = ymd(c(\"2020-01-01\", \"2021-01-01\", \"2022-01-01\")), lty = 2, alpha = 0.3) +\n    geom_hline(yintercept = 0, lty = 2) +  \n    geom_line() +  \n    scale_x_date(date_breaks = \"3 months\", date_labels = \"%b/%y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion()) +  \n    scale_y_tufte(breaks = tufte_breaks(plot_dat$breyting),\n                  labels = label_number(big.mark = \".\", decimal.mark = \",\"),\n                  limits = c(-1.8e4, NA)) +  \n    \n    labs(x = NULL, y = NULL,  \n         title = \"Fjöldi starfandi á almennum vinnumarkaði miðað við sama mánuð 2019\",\n         subtitle = \"Mars 2022 var annar mánuður frá 2020 þar sem fleiri unnu á almennum markaði en sama mánuð 2019\") +  \n    theme(plot.margin = margin(t = 5, r = 20, b = 5, l = 5))\n\np\n\n\n\n\n\n\n\n\n\n\n\n20172019\n\n\n\n\nCode\nplot_dat <- d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |>  \n    filter(year(dags) >= 2017) |>  \n    mutate(manudur = month(dags),\n           hlutf = Opinbert / (Annad + Opinbert)) |> \n    ungroup() |> \n    group_by(manudur) |>  \n    mutate(breyting = hlutf - hlutf[year(dags) == min(year(dags))]) |> \n    ungroup()\n\np <- plot_dat |> \n    ggplot(aes(dags, breyting)) +  \n    geom_vline(xintercept = ymd(c(\"2018-01-01\", \"2019-01-01\", \"2020-01-01\", \"2021-01-01\", \"2022-01-01\")), lty = 2, alpha = 0.3) +\n    geom_line() +  \n    scale_x_date(date_breaks = \"3 months\", date_labels = \"%b\\n%y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion()) + \n    scale_y_tufte(breaks = tufte_breaks(plot_dat$breyting),\n                  labels = label_percent(accuracy = 0.1)) +  \n    \n    labs(x = NULL, y = NULL,  \n         title = \"Munur á hlutfalli opinbers starfsfólks frá sama mánuði 2017\") +\n    theme(plot.margin = margin(t = 5, r = 20, b = 5, l = 5))\n\np\n\n\n\n\n\n\n\n\n\nCode\nplot_dat <- d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |>  \n    filter(year(dags) >= 2019) |>  \n    mutate(manudur = month(dags),\n           hlutf = Opinbert / (Annad + Opinbert)) |> \n    ungroup() |> \n    group_by(manudur) |>  \n    mutate(breyting = hlutf - hlutf[year(dags) == min(year(dags))]) |> \n    ungroup()\n\np <- plot_dat |> \n    ggplot(aes(dags, breyting)) +  \n    geom_vline(xintercept = ymd(c(\"2020-01-01\", \"2021-01-01\", \"2022-01-01\")), lty = 2, alpha = 0.3) +\n    geom_line() +  \n    scale_y_tufte(breaks = tufte_breaks(plot_dat$breyting),\n                  labels = label_percent(accuracy = 0.1)) +  \n    scale_x_date(date_breaks = \"3 months\", date_labels = \"%b\\n%y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion()) +  \n    labs(x = NULL, y = NULL,  \n         title = \"Munur á hlutfalli opinbers starfsfólks frá sama mánuði 2019\") +  \n    theme(plot.margin = margin(t = 5, r = 20, b = 5, l = 5),\n          plot.title = element_text(face = \"bold\"))\n\np\n\n\n\n\n\n\n\n\n\n\n\n\n\nÁrstíðaleiðrétt hlutfall opinbers starfsfólks\n\nMyndAðferð\n\n\n\n\nCode\nmodel_dat <- d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |>  \n    mutate(Heild = Opinbert + Annad) |> \n    filter(year(dags) >= 2008) |>  \n    mutate(manudur = month(dags),\n           timi = as.numeric(as.factor(dags)),\n           hlutf = Opinbert / (Annad + Opinbert)) |> \n    ungroup()\n\nm <- gam(Opinbert ~ s(manudur, bs = \"cc\") + s(timi, bs = \"ad\"), \n         data = model_dat, offset = log(Heild), family = nb(), method = \"REML\")\n\nplot_dat <- emmeans(m, ~ timi + manudur, at = list(timi = model_dat$timi,\n                                                   manudur = 1:12)) |> \n    tidy(type = \"response\") |> \n    group_by(timi) |> \n    mutate(wt = 1 / std.error,\n           wt = wt / sum(wt)) |> \n    summarise(response = sum(response * wt)) |> \n    inner_join(\n        model_dat,\n        by = \"timi\"\n    )\n\n\nopinbert_dat <- gam(Opinbert ~ s(manudur, bs = \"cc\") + s(timi, bs = \"ad\"), data = model_dat,\n                    family = nb(), method = \"REML\") |> \n    emmeans(~ timi, at = list(timi = unique(model_dat$timi))) |> \n    tidy() |> \n    inner_join(\n        model_dat |> \n            distinct(timi, dags)\n    ) |> \n    mutate(change = c(0, diff(estimate)),\n           perc_change = exp(change))\n\n\nalm_dat <- gam(Annad ~ s(manudur, bs = \"cc\") + s(timi, bs = \"ad\"), data = model_dat,\n               family = nb(), method = \"REML\") |> \n    emmeans(~ timi, at = list(timi = unique(model_dat$timi))) |> \n    tidy() |> \n    inner_join(\n        model_dat |> \n            distinct(timi, dags)\n    ) |> \n    mutate(change = c(0, diff(estimate)),\n           perc_change = exp(change))\n\n\nheild_dat <- gam(Heild ~ s(manudur, bs = \"cc\") + s(timi, bs = \"ad\"), data = model_dat,\n                 family = nb(), method = \"REML\") |> \n    emmeans(~ timi, at = list(timi = unique(model_dat$timi))) |> \n    tidy() |> \n    inner_join(\n        model_dat |> \n            distinct(timi, dags)\n    ) |> \n    mutate(change = c(0, diff(estimate)),\n           perc_change = exp(change))\n\nplot_dat2 <- heild_dat |> \n    mutate(tegund = \"Heild\") |> \n    bind_rows(\n        opinbert_dat |> \n            mutate(tegund = \"Opinber\")\n    )\n\n\ndates <- c(\"2009-08-01\", \"2018-01-01\", \"2021-01-01\")\n\np1 <- plot_dat |> \n    ggplot(aes(dags, hlutf)) +  \n    geom_vline(xintercept = ymd(dates), lty = 2, alpha = 0.5) +\n    geom_line(aes(y = hlutf), alpha = 0.1) +\n    geom_line(aes(y = response)) +  \n    scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n                 date_labels = \"%Y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), max(plot_dat$dags) + 20)) +\n    scale_y_tufte(breaks = tufte_breaks(plot_dat$hlutf),\n                  labels = label_percent(accuracy = 0.01)) +  \n    labs(x = NULL, y = NULL,  \n         title = \"Breytist hlutfall opinbers starfsfólks vegna opinbers eða almenns markaðar?\",\n         subtitle = \"Hlutfall opinbers starfsfólks af vinnumarkaði\") +  \n    theme(plot.margin = margin(t = 5, r = 60, b = 5, l = 5),\n          axis.line.x = element_blank(),\n          axis.text.x = element_blank(),\n          axis.ticks.x = element_blank())\n\np2 <- plot_dat2 |> \n    ggplot(aes(dags, perc_change)) +\n    geom_vline(xintercept = ymd(dates), lty = 2, alpha = 0.5) +\n    geom_hline(yintercept = 1, lty = 2) +\n    geom_line(aes(col = tegund)) +\n    geom_text(\n        data = plot_dat2 |> \n            filter(dags == max(dags)) |> \n            mutate(\n                y = case_when(\n                    tegund == \"Opinber\" ~ perc_change + 0.0004,\n                    tegund == \"Heild\" ~ perc_change - 0.0003,\n                )\n            ),\n        aes(y = y, label = tegund, col = tegund),\n        hjust = 0, nudge_x = 20\n    ) +\n    scale_x_date(date_breaks = \"year\", date_labels = \"%Y\", \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), max(plot_dat$dags) + 20)) +\n    scale_y_tufte(labels = function(x) percent(x - 1, prefix = \" \"),\n                  breaks = c(1, range(plot_dat2$perc_change), 1.005, 0.995),\n                  trans = \"log10\") +\n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    coord_cartesian(clip = \"off\") +\n    theme(plot.margin = margin(t = 0, r = 60, b = 5, l = 5),\n          legend.position = \"none\",\n          plot.subtitle = element_text(margin = margin(t = 0, r = 0, b = 10, l = 0))) +\n    labs(x = NULL,\n         y = NULL,\n         subtitle = \"Mánaðarleg hlutfallsleg breyting fjölda starfsfólks\")\n\n\np <- plot_grid(p1, p2, ncol = 1)\n\np\n\n\n\n\n\nCode\nggsave(plot = p, filename = \"hlutf_opinbert.png\",\n       width = 8, height = 0.621 * 8, scale = 1.3, bg = \"white\")\n\n\n\n\n\nLeiðrétting fyrir árstíðarsveiflumTeljarinn og nefnarinn\n\n\nVið getum hugsað að þetta séu tvö ferli:\n\nLangtímaferli sem breytist án mjög ákveðins mynsturs\nÁrstíðabundnar sveiflur sem eru að mestu leyti svipaðar frá ári til árs\n\nNotum GAM (Generalized Additive Models) til að meta bæði ferlin saman. Splæsibrúunin (e. splines) metur ferlið í tveimur hlutum, línulegum og ólínulegum, og notar stika til að toga ólínulega hlutann í átt að línulegu ferli.\n\nÞar sem hæga þróunin getur verið að breytast mishratt á mismunandi árabilum notum við aðlögunarsplæsibrúun (e. adaptive smoother) þar sem ólínulegi stikinn fær að breytast með tíma. Í kóðanum er þetta táknað með s(timi, bs = \"ad\")\nÁrstíðarferlið hefur þær skorður að frávikið í upphafi og byrjun ársins á að stefna í sömu tölu, þ.e. \\(\\text{31. desember} \\approx \\text{1. janúar}\\). Pakkinn mgcv býður upp á slíka hringrásarsplæsara (e. cyclic smooths) [alveg í ruglinu með íslenskuna núna]. Í kóðanum er þetta táknað með s(manudur, bs = \"cc\")\n\nÞegar við erum komin með mat á þessi tvö ferli er lítið mál að heilda yfir árstíðarbundnu sveiflurnar. Við vigtum árstíðarbundna matið eftir nákvæmni matsins í hverjum mánuði (einum deilt með staðalvillu matsins) og reiknum svo meðaltal eftir því.\nAllt í allt metum við þá líkanið svona (einfölduð útgáfa af kóða):\ngam(Opinbert ~ s(manudur, bs = \"cc\") + s(timi, bs = \"ad\"), offset = log(Heild), family = nb())\nFjöldi opinbers starfsfólks er jákvæð fjöldatala svo fyrsta ágískunin er alltaf neikvæða tvíkostadreifingin. Við metum líkanið á lograkvarða, bæði því það er náttúrulega matið fyrir dreifinguna, en líka því við búumst við því að útkoman breytist hlutfallslega milli ára.\nHér fyrir neðan sjáum við svo matið á árstíðaráhrifum:\n\n\nCode\nplot_dat <- emmeans(m, ~ manudur, at = list(manudur = seq(1, 12, length.out = 100))) |> \n    tidy(type = \"response\") |> \n    mutate(response = exp(log(response) - mean(log(response))))\n\nplot_dat |> \n    ggplot(aes(manudur, response)) +\n    geom_hline(yintercept = 1, lty = 2) +\n    geom_line() +\n    scale_x_tufte(breaks = 1:12,\n                  labels = c(\"Janúar\", \"Febrúar\", \"Mars\",\n                             \"Apríl\", \"Maí\", \"Júní\",\n                             \"Júli\", \"Ágúst\", \"September\",\n                             \"Október\", \"Nóvember\", \"Desember\")) +\n    scale_y_tufte(labels = function(x) percent(x - 1),\n                  breaks = tufte_breaks(plot_dat$response),\n                  limits = c(0.92, 1.08)) +\n    labs(x = \"Mánuður\",\n         y = \"Árstíðarbundnar sveiflur\",\n         title = \"Árstíðarsveiflur í hlutfalli opinbers starfsfólks\")\n\n\n\n\n\n\n\nHlutall (p) opinbers starfsfólks (O) af heildarfjölda starfsfólks (H) má skrifa\n\\[\np = \\frac{O}{H},\n\\]\nÞar sem \\(H\\) inniheldur líka starfsfólk á almennum vinnumarkaði (A), s.s. \\(H = O + A\\).\nSkoðum hlutfallið á tveimur mismunandi tímapunktum, \\(p_1\\) og \\(p_2\\).\n\\[\n\\frac{p_2}{p_1} = \\frac{O_2/H_2}{O_1/H_1} = \\frac{O_2/O_1}{H_2/H_1}.\n\\]\nEf \\(p_2 > p_1\\) og \\(p_1 \\neq 0\\) gildir að \\(p_2/p_1 > 1\\) og því\n\\[\n\\begin{aligned}\n\\frac{O_2/O_1}{H_2/H_1} &> 1 \\\\\n\\rightarrow \\frac{O_2}{O_1} &> \\frac{H_2}{H_1},\n\\end{aligned}\n\\]\nþ.e. fjöldi opinbers starfsfólks hefur vaxið hlutfallslega hraðar en fjöldi starfsfólks alls.\nÞetta er kannski augljóst, en það er gott að hafa þetta í huga þegar hlutfallið hækkar og athuga hvort það sé vegna mikilla opinberra ráðninga eða fækkunar starfa á almennum vinnumarkaði.\nHér nota ég GAM til að smootha gögnin og nota svo árstíðaleiðrétt smooth gögn til að reikna stöðugar mánaðarlegar breytingar og teiknum þær svo.\n\n\n\n\n\n\n\n\nÁrlegar breytingar\n\nHrein breytingEftir bakgrunniHlutfallsleg breytingEftir bakgrunni\n\n\n\n\nCode\nplot_dat <- d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |> \n    mutate(Heild = Annad + Opinbert) |> \n    pivot_longer(c(-dags), names_to = \"tegund\", values_to = \"n\") |> \n    filter(year(dags) >= 2008) |>  \n    mutate(manudur = month(dags)) |>\n    group_by(manudur, tegund) |>  \n    mutate(breyting = c(0, diff(n)),\n           uppsofnud_breyting = cumsum(breyting)) |> \n    ungroup() |> \n    filter(year(dags) > min(year(dags))) |> \n    mutate(tegund = fct_recode(tegund,\n                               \"Almennur\" = \"Annad\",\n                               \"Opinber\" = \"Opinbert\"))\n\np <- plot_dat |> \n    ggplot(aes(dags, breyting)) +  \n    # geom_vline(xintercept = ymd(seq.Date(from = min(plot_dat$dags),\n    #                                      to = ymd(\"2022-01-01\"),\n    #                                      by = \"year\")), lty = 2, alpha = 0.1) +\n    geom_hline(yintercept = 1, lty = 2, alpha = 0.6) +\n    geom_line(aes(col = tegund)) +  \n    geom_text(data = plot_dat |> filter(dags == max(dags)),\n              aes(label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n    scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n                 date_labels = \"%Y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), ymd(\"2023-10-01\"))) +  \n    scale_y_tufte(labels = label_number(big.mark = \".\", decimal.mark = \",\"),\n                  breaks = tufte_breaks(plot_dat$breyting)) +  \n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    # coord_cartesian(ylim = c(0.84, 1.127)) +\n    labs(x = NULL, y = NULL,  \n         title = \"Hrein árleg breyting á fjölda starfsfólks á vinnumarkaði (2009 - 2022)\",\n         subtitle = \"Y-ás táknar mun á fjölda vinnandi frá sama mánuði á síðasta ári\") + \n    theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 5),\n          legend.position = \"none\")\n\np\n\n\n\n\n\n\n\n\n\nCode\nplot_dat <- d |>  \n    filter(rekstrarform != \"Alls starfandi\") |>  \n    count(dags, tegund, bakgrunnur, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |> \n    mutate(Heild = Annad + Opinbert) |> \n    pivot_longer(c(-dags, -bakgrunnur), names_to = \"tegund\", values_to = \"n\") |> \n    filter(year(dags) >= 2008) |>  \n    mutate(manudur = month(dags)) |>\n    group_by(manudur, tegund, bakgrunnur) |>  \n    mutate(breyting = c(0, diff(n)),\n           uppsofnud_breyting = cumsum(breyting)) |> \n    ungroup() |> \n    filter(year(dags) > min(year(dags))) |> \n    mutate(tegund = fct_recode(tegund,\n                               \"Almennur\" = \"Annad\",\n                               \"Opinber\" = \"Opinbert\"),\n           y = breyting,\n           y = case_when(tegund == \"Heild\" ~ y * 1.06,\n                         tegund == \"Almennur\" ~ y * 0.95,\n                         TRUE ~ y))\n\np1 <- plot_dat |> \n    filter(bakgrunnur == \"Íslenskur bakgrunnur\") |> \n    ggplot(aes(dags, breyting)) +  \n    geom_line(data = tibble(x = range(plot_dat$dags), y = c(0, 0)),\n              aes(x = x, y = y), lty = 2, alpha = 0.5, inherit.aes =) +\n    geom_line(aes(col = tegund)) +  \n    geom_text(data = plot_dat |> filter(dags == max(dags), bakgrunnur == \"Íslenskur bakgrunnur\"),\n              aes(y = y, label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n    geom_rangeframe(sides = \"l\") +  \n    scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n                 date_labels = \"%b/%Y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), ymd(\"2024-01-01\"))) +  \n    scale_y_continuous(labels = label_number(),\n                       breaks = c(0, range(plot_dat$breyting[plot_dat$bakgrunnur == \"Íslenskur bakgrunnur\"])),\n                       limits = range(plot_dat$breyting[plot_dat$bakgrunnur == \"Íslenskur bakgrunnur\"]), \n                       oob = oob_keep) +  \n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    facet_grid(bakgrunnur ~ .) +\n    labs(x = NULL, y = NULL,\n         title = \"Hrein árleg breyting á fjölda starfsfólks á vinnumarkaði (2009 - 2022)\",\n         subtitle = \"Y-ás táknar mun á fjölda vinnandi frá sama mánuði árið á undan\",) +  \n    coord_cartesian(clip = \"off\") +\n    theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 5),\n          legend.position = \"none\",\n          axis.line = element_blank(),\n          axis.text.x = element_blank(),\n          axis.ticks.x = element_blank())\n\np2 <- plot_dat |> \n    filter(bakgrunnur == \"Innflytjendur\") |> \n    ggplot(aes(dags, breyting)) +  \n    geom_line(data = tibble(x = range(plot_dat$dags), y = c(0, 0)),\n              aes(x = x, y = y), lty = 2, alpha = 0.5, inherit.aes = FALSE) +\n    geom_line(aes(col = tegund)) +  \n    geom_text(data = plot_dat |> filter(dags == max(dags), bakgrunnur == \"Innflytjendur\"),\n              aes(y = y, label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n    geom_rangeframe(sides = \"l\") +  \n    scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n                 date_labels = \"%b/%Y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), ymd(\"2024-01-01\"))) +  \n    scale_y_continuous(labels = label_number(),\n                       breaks = c(0, range(plot_dat$breyting[plot_dat$bakgrunnur == \"Innflytjendur\"])),\n                       limits = range(plot_dat$breyting[plot_dat$bakgrunnur == \"Innflytjendur\"]),\n                       oob = oob_keep) +  \n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    facet_grid(bakgrunnur ~ .) +\n    labs(x = NULL, y = NULL) +  \n    coord_cartesian(clip = \"off\") +\n    theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 9),\n          legend.position = \"none\",\n          axis.line = element_blank(),\n          axis.text.x = element_blank(),\n          axis.ticks.x = element_blank())\n\np3 <- plot_dat |> \n    filter(bakgrunnur == \"Alls\") |> \n    ggplot(aes(dags, breyting)) +  \n    geom_line(data = tibble(x = range(plot_dat$dags), y = c(0, 0)),\n              aes(x = x, y = y), lty = 2, alpha = 0.5, inherit.aes = FALSE) +\n    geom_line(aes(col = tegund)) +  \n    geom_text(data = plot_dat |> filter(dags == max(dags), bakgrunnur == \"Alls\"),\n              aes(y = y, label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n    geom_rangeframe() +  \n    scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n                 date_labels = \"%Y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), ymd(\"2024-01-01\"))) +  \n    scale_y_continuous(labels = label_number(),\n                       breaks = c(range(plot_dat$breyting), 0),\n                       limits = range(plot_dat$breyting),\n                       oob = oob_keep) +  \n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    facet_grid(bakgrunnur ~ .) +\n    labs(x = NULL, y = NULL,) +  \n    coord_cartesian(clip = \"off\") +\n    theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 5),\n          legend.position = \"none\",\n          axis.line = element_blank())\n\np <- plot_grid(p1, p2, p3, ncol = 1, rel_heights = c(1, 0.85, 1))\n\np\n\n\n\n\n\n\n\n\n\nCode\nplot_dat <- d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |> \n    mutate(Heild = Annad + Opinbert) |> \n    pivot_longer(c(-dags), names_to = \"tegund\", values_to = \"n\") |> \n    filter(year(dags) >= 2008) |>  \n    mutate(manudur = month(dags)) |>\n    group_by(manudur, tegund) |>  \n    mutate(breyting = c(1, exp(diff(log(n)))),\n           uppsofnud_breyting = exp(cumsum(log(breyting)))) |> \n    ungroup() |> \n    filter(year(dags) > min(year(dags))) |> \n    mutate(tegund = fct_recode(tegund,\n                               \"Almennur\" = \"Annad\",\n                               \"Opinber\" = \"Opinbert\"))\n\np <- plot_dat |> \n    ggplot(aes(dags, breyting)) +  \n    # geom_vline(xintercept = ymd(seq.Date(from = min(plot_dat$dags),\n    #                                      to = ymd(\"2022-01-01\"),\n    #                                      by = \"year\")), lty = 2, alpha = 0.1) +\n    geom_hline(yintercept = 1, lty = 2, alpha = 0.6) +\n    geom_line(aes(col = tegund)) +  \n    geom_text(data = plot_dat |> filter(dags == max(dags)),\n              aes(label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n    scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n                 date_labels = \"%Y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), ymd(\"2023-10-01\"))) +  \n    scale_y_tufte(breaks = tufte_breaks(plot_dat$breyting),\n                  labels = function(x) percent(x - 1),\n                  trans = \"log10\") +  \n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    coord_cartesian(ylim = c(0.84, 1.127)) +\n    labs(x = NULL, y = NULL,  \n         title = \"Hlutfallsleg árleg breyting á fjölda starfsfólks á vinnumarkaði (2009 - 2022)\",\n         subtitle = \"Y-ás er á lograkvarða svo að -50% og +100% eru jafnlangt frá 0% breytingu\") +   \n    theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 5),\n          legend.position = \"none\")\n\np\n\n\n\n\n\nCode\nggsave(plot = p, filename = \"hlutf_breyting_saman.png\",\n       width = 8, height = 0.621 * 8, scale = 1.3, bg = \"white\")\n\n\n\n\n\n\nCode\nplot_dat <- d |>  \n    filter(rekstrarform != \"Alls starfandi\") |>  \n    count(dags, tegund, bakgrunnur, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |> \n    mutate(Heild = Annad + Opinbert) |> \n    pivot_longer(c(-dags, -bakgrunnur), names_to = \"tegund\", values_to = \"n\") |> \n    filter(year(dags) >= 2008) |>  \n    mutate(manudur = month(dags)) |>\n    group_by(manudur, tegund, bakgrunnur) |>  \n    mutate(breyting = c(1, exp(diff(log(n))))) |> \n    ungroup() |> \n    filter(year(dags) > min(year(dags))) |> \n    mutate(tegund = fct_recode(tegund,\n                               \"Almennur\" = \"Annad\",\n                               \"Opinber\" = \"Opinbert\"),\n           y = breyting,\n           y = case_when(tegund == \"Heild\" ~ y * (1 - 0.015 * (bakgrunnur == \"Innflytjendur\")),\n                         tegund == \"Almennur\" ~ y * 1,\n                         TRUE ~ y))\n\np1 <- plot_dat |> \n    filter(bakgrunnur == \"Íslenskur bakgrunnur\") |> \n    ggplot(aes(dags, breyting)) +  \n    geom_line(data = tibble(x = range(plot_dat$dags), y = c(1, 1)),\n              aes(x = x, y = y), lty = 2, alpha = 0.5, inherit.aes = FALSE) +\n    geom_line(aes(col = tegund)) +  \n    geom_text(data = plot_dat |> filter(dags == max(dags), bakgrunnur == \"Íslenskur bakgrunnur\"),\n              aes(y = y, label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n    geom_rangeframe(sides = \"l\") +  \n    scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n                 date_labels = \"%b/%Y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), ymd(\"2024-01-01\"))) +  \n    scale_y_log10(breaks = c(range(plot_dat$breyting[plot_dat$bakgrunnur == \"Íslenskur bakgrunnur\"], na.rm = T), 1),\n                  labels = function(x) percent(x - 1)) +  \n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    facet_grid(bakgrunnur ~ .) +\n    labs(x = NULL, y = NULL,\n         title = \"Hlutfallsleg árleg breyting á fjölda starfsfólks á vinnumarkaði (2009 - 2022)\",\n         subtitle = \"Y-ás er á lograkvarða svo að -50% og +100% eru jafnlangt frá 0% breytingu\") +  \n    coord_cartesian(clip = \"off\") +\n    theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 5),\n          legend.position = \"none\",\n          axis.line = element_blank(),\n          axis.text.x = element_blank(),\n          axis.ticks.x = element_blank())\n\np2 <- plot_dat |> \n    filter(bakgrunnur == \"Innflytjendur\") |> \n    ggplot(aes(dags, breyting)) +  \n    geom_line(data = tibble(x = range(plot_dat$dags), y = c(1, 1)),\n              aes(x = x, y = y), lty = 2, alpha = 0.5, inherit.aes = FALSE) +\n    geom_line(aes(col = tegund)) +  \n    geom_text(data = plot_dat |> filter(dags == max(dags), bakgrunnur == \"Innflytjendur\"),\n              aes(y = y, label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n    geom_rangeframe(sides = \"l\") +  \n    scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n                 date_labels = \"%b/%Y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), ymd(\"2024-01-01\"))) +  \n    scale_y_log10(breaks = c(range(plot_dat$breyting[plot_dat$bakgrunnur == \"Innflytjendur\"], na.rm = T), 1),\n                  labels = function(x) percent(x - 1)) +  \n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    facet_grid(bakgrunnur ~ .) +\n    labs(x = NULL, y = NULL) +  \n    coord_cartesian(clip = \"off\") +\n    theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 9),\n          legend.position = \"none\",\n          axis.line = element_blank(),\n          axis.text.x = element_blank(),\n          axis.ticks.x = element_blank())\n\np3 <- plot_dat |> \n    filter(bakgrunnur == \"Alls\") |> \n    ggplot(aes(dags, breyting)) +  \n    geom_line(data = tibble(x = range(plot_dat$dags), y = c(1, 1)),\n              aes(x = x, y = y), lty = 2, alpha = 0.5, inherit.aes = FALSE) +\n    geom_line(aes(col = tegund)) +  \n    geom_text(data = plot_dat |> filter(dags == max(dags), bakgrunnur == \"Alls\"),\n              aes(y = y, label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n    geom_rangeframe(sides = \"lb\") +  \n    scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n                 date_labels = \"%Y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), ymd(\"2024-01-01\"))) +  \n    scale_y_log10(breaks = c(range(plot_dat$breyting[plot_dat$bakgrunnur == \"Alls\"], na.rm = T), 1),\n                  labels = function(x) percent(x - 1)) +  \n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    facet_grid(bakgrunnur ~ .) +\n    labs(x = NULL, y = NULL,) +  \n    coord_cartesian(clip = \"off\") +\n    theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 5),\n          legend.position = \"none\",\n          axis.line = element_blank())\n\np <- plot_grid(p1, p2, p3, ncol = 1, rel_heights = c(1, 0.85, 1))\n\np"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Metill",
    "section": "",
    "text": "Fjármál stjórnmálaflokkanna\n      \n      \n      \n        Greining á ársreikningum stjórnmálaflokka úr gögnum Ríkisendurskoðunar\n        \n        Sep 17, 2022\n      \n    \n  \n  \n    \n      \n    \n    \n      \n        Hvað kostar kosningaherferð?\n      \n      \n      \n        Niðurstöður alþingiskosninga tengdar við fjármál stjórnmálaflokkanna\n        \n        Sep 17, 2022\n      \n    \n  \n  \n    \n      \n    \n    \n      \n        Tekjur, skattar og kaupmáttur\n      \n      \n      \n        Greining á tekjuskattsgögnum  sem Hagstofan vinnur úr skattframtölum Íslendinga\n        \n        Sep 11, 2022\n      \n    \n  \n\n\nNo matching items\n\n\nAllar greinar\n\nMælaborð\n\n\n  \n    \n      \n    \n    \n      \n        Fjármál Sveitarfélaga\n      \n      \n      \n        Gagnvirk samantekt á ársreikningum sveitarfélaga úr gögnum Sambands Íslenskra Sveitarfélaga\n        \n        Sep 18, 2022\n      \n    \n  \n  \n    \n      \n    \n    \n      \n        Eignir, skuldir og skattar\n      \n      \n      \n        Gagnvirkt tól til að skoða eignir, tekjur og skuldir Íslendinga í skattframtalsgögnum Hagstofunnar\n        \n        Aug 25, 2022\n      \n    \n  \n\n\nNo matching items"
  },
  {
    "objectID": "posts.html",
    "href": "posts.html",
    "title": "Færslur",
    "section": "",
    "text": "Greining á ársreikningum stjórnmálaflokka úr gögnum Ríkisendurskoðunar\n\n\n\n\nstjórnmál\n\n\nefnahagur\n\n\nársreikningar\n\n\nR\n\n\níslenska\n\n\n \n\n\n\n\nSep 17, 2022\n\n\n\n\n\n\n  \n\n\n\n\n\nNiðurstöður alþingiskosninga tengdar við fjármál stjórnmálaflokkanna\n\n\n\n\nstjórnmál\n\n\nkosningar\n\n\nR\n\n\níslenska\n\n\n \n\n\n\n\nSep 17, 2022\n\n\n\n\n\n\n  \n\n\n\n\n\nGreining á tekjuskattsgögnum sem Hagstofan vinnur úr skattframtölum Íslendinga\n\n\n\n\nskattar\n\n\nefnahagur\n\n\nR\n\n\níslenska\n\n\n \n\n\n\n\nSep 11, 2022\n\n\n\n\n\n\n  \n\n\n\n\n\nHver er fjöldi starfandi einstaklinga og hvernig skiptast þeir á vinnumarkaði?\n\n\n\n\nefnahagur\n\n\nvinnumarkaður\n\n\nHagstofa\n\n\nR\n\n\níslenska\n\n\n \n\n\n\n\nSep 10, 2022\n\n\n\n\n\n\n  \n\n\n\n\n\nVísitalan og áhrif undirtalna á heildina\n\n\n\n\nefnahagur\n\n\nverðlag\n\n\nHagstofa\n\n\níslenska\n\n\n \n\n\n\n\nAug 30, 2022\n\n\n\n\n\n\n  \n\n\n\n\n\nHvaða upplýsingar eru til um rekstur Landspítalans og hvar má finna þær?\n\n\n\n\nlandspítali\n\n\níslenska\n\n\n \n\n\n\n\nAug 24, 2022\n\n\n\n\n\n\nNo matching items"
  }
]