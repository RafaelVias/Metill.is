---
title: "Fólksflutningar og hælisleitendur"
pagetitle: "Fólksflutningar og hælisleitendur"
subtitle: "Hvað segja gögnin um fjölda hælisleitenda og fólksflutninga til Íslands?"
description: |
  Hér eru gögn um fjölda hælisleitenda, fjölda samþykktra verndarumsókna og fjölda innflytjenda á höfðatölu tekin saman úr gögnum OECD og Eurostat. Auk þess er þátttaka innflytjenda á atvinnumarkaði skoðuð.
author: 
    -   name: "Brynjólfur Gauti Guðrúnar Jónsson"
        url: "https://twitter.com/bgautijonsson"
        affiliation: "Tölfræði, Raunvísindadeild Háskóla Íslands"
        affiliation-url: "https://www.hi.is/tolfraedi_0"
date: "2022/11/10"
format: 
    html:
        code-fold: true
        smooth-scroll: true
        link-external-newwindow: true
        toc: true
        toc-location: right
        toc-title: Efnisyfirlit
editor: source
draft: true
title-block-banner: true
categories:
    - stjórnmál
    - fólksflutningar
href: greinar/flottafolk/index.qmd
image: Figures/haelisl_uppsafnad.png
execute: 
  eval: false
---


```{r}
#| include: false

library(cowplot)
library(tidyverse)
library(scales)
library(ggthemes)
library(kableExtra)
library(gganimate)
library(lubridate)
library(geomtextpath)
library(ggtext)
library(readxl)
library(janitor)
library(plotly)
library(tidyverse)
library(lubridate)
library(ggthemes)
library(cowplot)
library(scales)
library(visitalaneysluverds)
library(feather)
library(gganimate)
library(metill)
library(patchwork)
library(arrow)
library(glue)
library(eurostat)
theme_set(theme_metill())


```


```{r}
eurostat::search_eurostat("Beneficiaries of temporary protection")
```

```{r}
beneficiaries <- eurostat::get_eurostat("migr_asytpsm") |>
  filter(
    sex == "T",
    age == "TOTAL",
    citizen == "TOTAL"
  ) |> 
  select(-unit, -sex, -age, -citizen)

beneficiaries
```

```{r}
pop <- get_eurostat("demo_pjan") |> 
  filter(
    age == "TOTAL",
    sex == "T"
  ) |> 
  select(-unit, -age, -sex)
```

```{r}
d <- beneficiaries |> 
  mutate(
    year = year(time)
  ) |> 
  rename(beneficiaries = values) |> 
  inner_join(
    pop |> 
      group_by(geo) |> 
      filter(time == max(time)) |> 
      ungroup() |> 
      select(geo, pop = values),
    by = c("geo")
  ) |> 
  inner_join(
    geo
  ) |> 
  select(-geo) |> 
  select(land, time, beneficiaries, pop) |> 
  mutate(per_pop = beneficiaries / pop * 1e3)
```



```{r}
if (!file.exists("data/data.csv")) {
  
  country_names <- tribble(
    ~country, ~land,
    "Australia", "Ástralía",
    "Belgium", "Belgía",
    "Bulgaria", "Búlgaría",
    "Canada", "Kanada",
    "Czech Republic", "Tékkland",
    "Denmark", "Danmörk",
    "Estonia", "Eistland",
    "Finland", "Finnland",
    "France", "Frakkland",
    "Germany", "Þýskaland",
    "Greece", "Grikkland",
    "Hungary", "Ungverjaland",
    "Iceland", "Ísland",
    "Ireland", "Írland",
    "Israel", "Ísrael",
    "Italy", "Ítalía", 
    "Latvia", "Latvía",
    "Luxembourg", "Lúxemborg",
    "New Zealand", "Nýja Sjáland",
    "Norway", "Noregur",
    "Netherlands", "Holland",
    "Poland", "Pólland",
    "Portugal", "Portúgal",
    "Slovak Republic", "Slóvakía",
    "Slovenia", "Slóvenía",
    "Spain", "Spánn",
    "Sweden", "Svíþjóð",
    "Switzerland", "Sviss",
    "United Kingdom", "Bretland",
    "United States", "Bandaríkin"
  )
  
  geo <- tribble(
    ~geo, ~land,
    "AT", "Austurríki",
    "BE", "Belgía",
    "BG", "Búlgaría",
    "CH", "Sviss",
    "CY", "Kýpur",
    "CZ", "Tékkland",
    "DE", "Þýskaland",
    "DK", "Danmörk",
    "EE", "Eistland",
    "EL", "Grikkland",
    "ES", "Spánn",
    "FI", "Finnland",
    "FR", "Frakkland",
    "HU", "Hungary",
    "HR", "Króatía",
    "IE", "Írland",
    "IS", "Ísland",
    "IT", "Ítalía",
    "LI", "Liechtenstein",
    "LT", "Litáen",
    "LU", "Lúxemborg",
    "LV", "Latvía",
    "ME", "Svartfjallaland",
    "MT", "Malta",
    "NL", "Holland",
    "NO", "Noregur",
    "PL", "Pólland",
    "PT", "Portúgal",
    "RO", "Rúmenía",
    "SE", "Svíþjóð",
    "SI", "Slóvenía",
    "SK", "Slóvakía",
    "UK", "Bretland"
  )
  
  pop <- read_csv("data/HISTPOP_05112022174045625.csv")
  
  mig <- read_csv("data/MIG_05112022173659951.csv") 
  
  employ <- read_csv("data/MIG_NUP_RATES_GENDER_08112022143516881.csv")
  
  decisions <- read_tsv("data/migr_asydcfstq__custom_3797485_tabular.tsv") |> 
    separate(col = 1, into = c("freq", "unit", "citizen", "sex", "age", "decision", "geo"), sep = ",") |> 
    pivot_longer(c(-(1:7))) |> 
    separate(name, into = c("year", "month"), sep = "-Q", convert = TRUE) |> 
    mutate(value = parse_number(value)) |> 
    count(year, geo, decision, wt = value, name = "value") |> 
    inner_join(
      geo,
      by = "geo"
    ) |> 
    select(-geo) |> 
    pivot_wider(names_from = decision) |> 
    select(ar = year, land, samthykkt = TOTAL_POS, hafnad = REJECTED)
  
  d <- mig |> 
    janitor::clean_names() |> 
    select(year, country, nationality = country_of_birth_nationality, variable, value) |> 
    filter(nationality != "Total") |> 
    pivot_wider(names_from = "variable", values_from = "value") |> 
    janitor::clean_names() |> 
    select(
      year, country, nationality,
      inflow_pop = inflows_of_foreign_population_by_nationality, 
      inflow_workers = inflows_of_foreign_workers_by_nationality,
      outflow = outflows_of_foreign_population_by_nationality, 
      asylum = inflows_of_asylum_seekers_by_nationality,
      acquisition =acquisition_of_nationality_by_country_of_former_nationality,
      stock = stock_of_foreign_born_population_by_country_of_birth
    ) |> 
    inner_join(
      pop |> 
        janitor::clean_names() |> 
        select(year = time, country, pop = value),
      by = c("country", "year")
    ) |> 
    group_by(year, country, pop) |> 
    summarise_at(vars(inflow_pop:stock), sum, na.rm = T) |> 
    ungroup() |> 
    inner_join(
      country_names,
      by = "country"
    ) |> 
    select(
      ar = year,
      land,
      mannfjoldi = pop,
      innfluttir = inflow_pop,
      utfluttir = outflow,
      haelisumsoknir = asylum,
      nyir_innlendir_rikisborgarar = acquisition,
      erlendir_rikisborgarar_samtals = stock
    ) |> 
    full_join(
      decisions,
      by = c("ar", "land")
    ) |> 
    pivot_longer(c(-(ar:mannfjoldi))) |> 
    arrange(ar, land) |> 
    group_by(land) |> 
    fill(mannfjoldi, .direction = "down") |> 
    ungroup() |> 
    # mutate(value = value / mannfjoldi * 1e3) |> 
    pivot_wider() |> 
    select(-mannfjoldi) 
  
  
  
  
  d <- employ |> 
    janitor::clean_names() |> 
    filter(
      gender == "TOT",
      birth == "FB"
    ) |> 
    select(country = country_2, ar = year, rate, value) |> 
    pivot_wider(names_from = rate, values_from = value) |> 
    rename(hlutf_med_vinnu = N_RATE, hlutf_atvinnulaus = U_RATE, hlutf_i_vinnuafli = P_RATE) |> 
    mutate_at(vars(hlutf_med_vinnu:hlutf_i_vinnuafli), function(x) x / 100) |> 
    inner_join(
      country_names,
      by = "country"
    ) |> 
    select(-country) |> 
    full_join(
      d,
      by = c("ar", "land")
    )
  
  d |> 
    write_csv("data/data.csv")
  
  read_tsv("data/migr_asytpsm__custom_3925115_tabular.tsv", col_types = c("cnnnnnnnn")) |> 
    separate(
      col = 1,
      into = c("freq", "unit", "citizen", "sex", "age", "geo"),
      sep = ","
    ) |> 
    pivot_longer(c(-(1:6)), names_to = "dags", values_to = "n") |> 
    separate(col = dags, into = c("ar", "man"), convert = T) |> 
    mutate(dags = clock::date_build(year = ar, month = man)) |> 
    inner_join(
      geo,
      by = "geo"
    ) |> 
    select(-geo) |> 
    inner_join(
      pop |> 
        janitor::clean_names() |> 
        select(ar = time, country, pop = value) |> 
        group_by(country) |> 
        filter(ar == max(ar)) |> 
        ungroup() |> 
        inner_join(
          country_names,
          by = "country"
        ) |> 
        select(-country, -ar),
      by = c("land")
    ) |> 
    select(land, dags, ar, land_fra = citizen, flottafjoldi = n, mannfjoldi = pop) |> 
    write_csv("data/flottafolk_manadarlegt.csv")
  
  
} else {
  d <- read_csv("data/data.csv")
}

caption <- "Mynd eftir @bggjonsson hjá metill.is byggð á gögnum OECD um fólksflutninga: https://stats.oecd.org/Index.aspx?DataSetCode=MIG\nGögn og kóði: https://github.com/bgautijonsson/Metill.is/tree/master/greinar/flottafolk"

litur_island <- "#08306b"
litur_danmork <- "#e41a1c"
litur_finnland <- "#3690c0"
litur_noregur <- "#7f0000"
litur_svithjod <- "#fd8d3c"
litur_annad <- "#737373"

```


# Gögn

Gögnin sem eru notuð í þessari greiningu [koma frá gögnum OECD um fólksflutninga](https://stats.oecd.org/viewhtml.aspx?datasetcode=MIG&lang=en){target="_blank"}og [gögnum Eurostat um ákvarðanir í verndarumsóknum](https://ec.europa.eu/eurostat/databrowser/404-product?lang=en){target="_blank"}. Hægt er að nálgast unnin gögn sem eru notuð í þessari greiningu [hér](https://flatgithub.com/bgautijonsson/Metill.is/blob/master/greinar/flottafolk/data/data.csv?filename=greinar%2Fflottafolk%2Fdata%2Fdata.csv&filters=&sha=ae169374ae234cb43981623ef8e61a0083ff4fe8&sort=ar%2Casc&stickyColumnName=ar){target="_blank"}.

# Umsóknir um hæli

```{r}
p1 <- d |> 
  filter(ar == 2021) |> 
  drop_na(haelisumsoknir) |> 
  group_by(land) |> 
  summarise(haelisumsoknir = sum(haelisumsoknir)) |> 
  mutate(
    colour = case_when(
      land == "Ísland" ~ litur_island,
      land == "Danmörk" ~ litur_danmork,
      land == "Finnland" ~ litur_finnland,
      land == "Noregur" ~ litur_noregur,
      land == "Svíþjóð" ~ litur_svithjod,
      TRUE ~ litur_annad
    ),
    linewidth = 1 * (land == "Ísland"),
    size = as_factor(linewidth),
    land = glue("<i style='color:{colour}'>{land}</i>"),
    land = fct_reorder(land, haelisumsoknir)
  ) |> 
  ggplot(aes(haelisumsoknir, land, col = colour, size = size)) +
  geom_point() +
  geom_segment(aes(yend = land, xend = 0, linewidth = linewidth), lty = 2, alpha = 0.5) +
  scale_x_continuous(
    expand = expansion(),
    limits = c(0, 2.5)
  ) +
  scale_colour_identity() +
  scale_size_manual(values = c(1, 3)) +
  scale_linewidth(
    range = c(0.2, 0.4)
  ) +
  theme(
    plot.margin = margin(t = 5, r = 25, b = 5, l = 5),
    axis.text.y = element_markdown(size = 10, family = "Lato"),
    legend.position = "none"
  ) +
  labs(
    x = NULL,
    y = NULL,
    title = "Hvaða land tekur núna við flestum umsóknum um hæli?",
    subtitle = "Fjöldi umsókna árið 2021",
    caption = caption
  )


ggsave(
  plot = p1,
  filename = "Figures/haelisl_2021.png",
  width = 8, height = 0.5 * 8, scale = 1.3
)

p2 <- d |> 
  drop_na(haelisumsoknir) |> 
  group_by(land) |> 
  summarise(haelisumsoknir = sum(haelisumsoknir)) |> 
  mutate(
    colour = case_when(
      land == "Ísland" ~ litur_island,
      land == "Danmörk" ~ litur_danmork,
      land == "Finnland" ~ litur_finnland,
      land == "Noregur" ~ litur_noregur,
      land == "Svíþjóð" ~ litur_svithjod,
      TRUE ~ litur_annad
    ),
    linewidth = 1 * (land == "Ísland"),
    size = as_factor(linewidth),
    land = glue("<i style='color:{colour}'>{land}</i>"),
    land = fct_reorder(land, haelisumsoknir)
  ) |> 
  ggplot(aes(haelisumsoknir, land, col = colour, size = size)) +
  geom_point() +
  geom_segment(aes(yend = land, xend = 0, linewidth = linewidth), lty = 2, alpha = 0.5) +
  scale_x_continuous(
    expand = expansion(),
    limits = c(0, 80)
  ) +
  scale_colour_identity() +
  scale_size_manual(values = c(1, 3)) +
  scale_linewidth(
    range = c(0.2, 0.4)
  ) +
  theme(
    plot.margin = margin(t = 5, r = 25, b = 5, l = 5),
    axis.text.y = element_markdown(size = 10),
    legend.position = "none"
  ) +
  labs(
    x = NULL,
    y = NULL,
    title = "Hvaða land hefur tekið við flestum umsóknum um hæli?",
    subtitle = "Fjöldi umsókna 2000 til 2021",
    caption = caption
  )

ggsave(
  plot = p2,
  filename = "Figures/haelisl_uppsafnad.png",
  width = 8, height = 0.5 * 8, scale = 1.3
)

p <- (p1 + labs(title = NULL, caption = NULL)) + 
  (p2 + labs(title = NULL, caption = NULL)) +
  plot_annotation(
    title = "Hvaða land hefur tekið við flestum umsóknum um hæli?",
    caption = caption
  )

ggsave(
  plot = p,
  filename = "Figures/haelisl_saman.png",
  width = 8, height = 0.5 * 8, scale = 1.3
)

plot_dat <- d |> 
  drop_na(haelisumsoknir) |> 
  select(ar, land, value = haelisumsoknir) |> 
  mutate(
    colour = case_when(
      land == "Ísland" ~ litur_island,
      land == "Danmörk" ~ litur_danmork,
      land == "Finnland" ~ litur_finnland,
      land == "Noregur" ~ litur_noregur,
      land == "Svíþjóð" ~ litur_svithjod,
      TRUE ~ litur_annad
    ),
    linewidth = 1 * (land == "Ísland"),
    size = as_factor(linewidth)
  )

p3 <-plot_dat |> 
  ggplot(aes(ar, value)) +
  geom_line(
    data = plot_dat |> 
      filter(colour == litur_annad),
    aes(group = land, colour = litur_annad),
    alpha = 0.3,
    col = litur_annad
  ) +
  geom_line(
    data = plot_dat |> 
      filter(colour != litur_annad),
    aes(group = land, colour = colour),
    linewidth = 1
  ) +
  geom_text(
    data = plot_dat |> 
      filter(colour != litur_annad, ar == max(ar)) |> 
      mutate(
        value = case_when(
          land == "Danmörk" ~ value + 0.3,
          land == "Finnland" ~ value - 0.3,
          TRUE ~ value
        )
      ),
    aes(label = land, colour = colour),
    hjust = 0,
    nudge_x = 0.1
  ) +
  scale_x_tufte(
    breaks = tufte_breaks(plot_dat$ar),
    limits = c(2000, 2021.8)
  ) +
  scale_y_tufte(
    breaks = tufte_breaks(plot_dat$value[plot_dat$value <= 15]),
    labels = label_number(accuracy = 1),
    limits = c(0, NA),
    expand = expansion()
  ) +
  scale_colour_identity() +
  coord_cartesian(ylim = c(0, 7.5)) +
  labs(
    x = NULL,
    y = NULL,
    subtitle = "Fjöldi umsókna eftir ári"
  )

p <- (
  (p1 + labs(title = NULL, caption = NULL)) + 
    (p2 + labs(title = NULL, caption = NULL))
)/
  p3 +
  plot_annotation(
    title = "Hvaða land hefur tekið við flestum umsóknum um hæli?",
    subtitle = "Sýnt sem fjöldi hælisleitenda á 1.000 íbúa lands",
    caption = caption
  )

ggsave(
  plot = p,
  filename = "Figures/haelisl_saman_2.png",
  width = 8, height = 1 * 8, scale = 1.3
)
```

![](Figures/haelisl_saman_2.png){.column-page}

# Samþykktar umsóknir

```{r}
caption <- "Mynd eftir @bggjonsson hjá metill.is byggð á gögnum Eurostat: https://ec.europa.eu/eurostat/databrowser/view/MIGR_ASYDCFSTQ__custom_3796551/default/table?lang=en\nGögn og kóði: https://github.com/bgautijonsson/Metill.is/tree/master/greinar/flottafolk"


p1 <- d |> 
  filter(ar == 2022) |> 
  mutate(
    colour = case_when(
      land == "Ísland" ~ litur_island,
      land == "Danmörk" ~ litur_danmork,
      land == "Finnland" ~ litur_finnland,
      land == "Noregur" ~ litur_noregur,
      land == "Svíþjóð" ~ litur_svithjod,
      TRUE ~ litur_annad
    ),
    linewidth = 1 * (land == "Ísland"),
    size = as_factor(linewidth),
    land = glue("<i style='color:{colour}'>{land}</i>"),
    land = fct_reorder(land, samthykkt)
  ) |> 
  drop_na(samthykkt) |> 
  ggplot(aes(samthykkt, land, col = colour, size = size)) +
  geom_point() +
  geom_segment(aes(yend = land, xend = 0, linewidth = linewidth), lty = 2, alpha = 0.5) +
  scale_x_continuous(
    expand = expansion(),
    limits = c(0, 1.25)
  ) +
  scale_colour_identity() +
  scale_size_manual(values = c(1, 3)) +
  scale_linewidth(
    range = c(0.2, 0.4)
  ) +
  theme(
    plot.margin = margin(t = 5, r = 25, b = 5, l = 5),
    axis.text.y = element_markdown(size = 10, family = "Lato"),
    legend.position = "none"
  ) +
  labs(
    x = NULL,
    y = NULL,
    title = "Hvaða land tekur hefur samþykkt flestar hælisumsóknir í ár?",
    subtitle = "Fjöldi það sem af er ári 2022",
    caption = caption
  )


ggsave(
  plot = p1,
  filename = "Figures/samthykkt_2022.png",
  width = 8, height = 0.5 * 8, scale = 1.3
)

p2 <- d |> 
  drop_na(samthykkt) |> 
  group_by(land) |> 
  summarise(samthykkt = sum(samthykkt, na.rm = T)) |> 
  mutate(
    colour = case_when(
      land == "Ísland" ~ litur_island,
      land == "Danmörk" ~ litur_danmork,
      land == "Finnland" ~ litur_finnland,
      land == "Noregur" ~ litur_noregur,
      land == "Svíþjóð" ~ litur_svithjod,
      TRUE ~ litur_annad
    ),
    linewidth = 1 * (land == "Ísland"),
    size = as_factor(linewidth),
    land = glue("<i style='color:{colour}'>{land}</i>"),
    land = fct_reorder(land, samthykkt)
  ) |> 
  ggplot(aes(samthykkt, land, col = colour, size = size)) +
  geom_point() +
  geom_segment(aes(yend = land, xend = 0, linewidth = linewidth), lty = 2, alpha = 0.5) +
  scale_x_continuous(
    expand = expansion(),
    limits = c(0, 27)
  ) +
  scale_colour_identity() +
  scale_size_manual(values = c(1, 3)) +
  scale_linewidth(
    range = c(0.2, 0.4)
  ) +
  theme(
    plot.margin = margin(t = 5, r = 25, b = 5, l = 5),
    axis.text.y = element_markdown(size = 10),
    legend.position = "none"
  ) +
  labs(
    x = NULL,
    y = NULL,
    title = "Hvaða land tekur hefur samþykkt flestar hælisumsóknir alls?",
    subtitle = "Fjöldi frá 2008 til 2022",
    caption = caption
  )

ggsave(
  plot = p2,
  filename = "Figures/samthykkt_uppsafnad.png",
  width = 8, height = 0.5 * 8, scale = 1.3
)

p <- (p1 + labs(title = NULL, caption = NULL)) + 
  (p2 + labs(title = NULL, caption = NULL)) +
  plot_annotation(
    title = "Hvaða land hefur samþykkt flestar hælisumsóknir?",
    caption = caption
  )

ggsave(
  plot = p,
  filename = "Figures/samthykkt_saman.png",
  width = 8, height = 0.5 * 8, scale = 1.3
)

plot_dat <- d |> 
  drop_na(samthykkt) |> 
  select(ar, land, value = samthykkt) |> 
  mutate(
    colour = case_when(
      land == "Ísland" ~ litur_island,
      land == "Danmörk" ~ litur_danmork,
      land == "Finnland" ~ litur_finnland,
      land == "Noregur" ~ litur_noregur,
      land == "Svíþjóð" ~ litur_svithjod,
      TRUE ~ litur_annad
    ),
    linewidth = 1 * (land == "Ísland"),
    size = as_factor(linewidth)
  )

p3 <-plot_dat |> 
  ggplot(aes(ar, value)) +
  geom_line(
    data = plot_dat |> 
      filter(colour == litur_annad),
    aes(group = land, colour = litur_annad),
    alpha = 0.3,
    col = litur_annad
  ) +
  geom_line(
    data = plot_dat |> 
      filter(colour != litur_annad),
    aes(group = land, colour = colour),
    linewidth = 1
  ) +
  geom_text(
    data = plot_dat |> 
      filter(colour != litur_annad, ar == max(ar)) |> 
      mutate(
        value = case_when(
          land == "Svíþjóð" ~ value + 0.05,
          land == "Finnland" ~ value - 0.05,
          land == "Noregur" ~ value + 0.01,
          TRUE ~ value
        )
      ),
    aes(label = land, colour = colour),
    hjust = 0,
    nudge_x = 0.1
  ) +
  scale_x_tufte(
    breaks = tufte_breaks(plot_dat$ar),
    limits = c(2008, 2023)
  ) +
  scale_y_tufte(
    breaks = tufte_breaks(plot_dat$value[plot_dat$value <= 15]),
    labels = label_number(accuracy = 1),
    limits = c(0, NA),
    expand = expansion()
  ) +
  scale_colour_identity() +
  coord_cartesian(ylim = c(0, 3)) +
  labs(
    x = NULL,
    y = NULL,
    subtitle = "Fjöldi eftir ári"
  )

p <- (
  (p1 + labs(title = NULL, caption = NULL)) + 
    (p2 + labs(title = NULL, caption = NULL))
)/
  p3 +
  plot_annotation(
    title = "Hvaða land hefur samþykkt flestar umsóknir um vernd?",
    subtitle = "Sýnt sem fjöldi umsókna um vernd á 1.000 íbúa móttökulands sem voru samþykktar á fyrsta stjórnsýslu- eða dómstigi",
    caption = caption
  )

ggsave(
  plot = p,
  filename = "Figures/samthykkt_saman_2.png",
  width = 8, height = 1 * 8, scale = 1.3
)


plot_dat <- d |> 
  drop_na(samthykkt, hafnad) |> 
  mutate(value = samthykkt / (samthykkt + hafnad)) |> 
  select(ar, land, value) |> 
  filter(!is.nan(value)) |> 
  mutate(
    colour = case_when(
      land == "Ísland" ~ litur_island,
      land == "Danmörk" ~ litur_danmork,
      land == "Finnland" ~ litur_finnland,
      land == "Noregur" ~ litur_noregur,
      land == "Svíþjóð" ~ litur_svithjod,
      TRUE ~ litur_annad
    ),
    linewidth = 1 * (land == "Ísland"),
    size = as_factor(linewidth)
  )

p4 <- plot_dat |> 
  ggplot(aes(ar, value)) +
  geom_line(
    data = plot_dat |> 
      filter(colour == litur_annad),
    aes(group = land, colour = litur_annad),
    alpha = 0.3,
    col = litur_annad
  ) +
  geom_line(
    data = plot_dat |> 
      filter(colour != litur_annad),
    aes(group = land, colour = colour),
    linewidth = 1
  ) +
  geom_text(
    data = plot_dat |> 
      filter(colour != litur_annad, ar == max(ar)) |> 
      mutate(
        value = case_when(
          # land == "Svíþjóð" ~ value + 0.05,
          # land == "Finnland" ~ value - 0.05,
          # land == "Noregur" ~ value + 0.01,
          TRUE ~ value
        )
      ),
    aes(label = land, colour = colour),
    hjust = 0,
    nudge_x = 0.1
  ) +
  scale_x_tufte(
    breaks = c(plot_dat$ar),
    limits = c(2008, 2023)
  ) +
  scale_y_tufte(
    breaks = c(range(plot_dat$value), 0.25, 0.5, 0.75, 1),
    labels = label_hlutf(),
    # limits = c(0, NA),
    expand = expansion()
  ) +
  scale_colour_identity() +
  coord_cartesian(ylim = c(0, 1)) +
  labs(
    x = NULL,
    y = NULL,
    subtitle = "Hlutfall umsókna sem eru samþykktar á fyrsta stjórnsýslu- eða dómstigi"
  )

p <- (
  (p1 + labs(title = NULL, caption = NULL)) + 
    (p2 + labs(title = NULL, caption = NULL))
)/
  p3 /
  p4 +
  plot_annotation(
    title = "Hvaða land hefur samþykkt flestar umsóknir um vernd?",
    subtitle = "Sýnt sem fjöldi umsókna um vernd á 1.000 íbúa móttökulands sem voru samþykktar á fyrsta stjórnsýslu- eða dómstigi",
    caption = caption
  )

ggsave(
  plot = p,
  filename = "Figures/samthykkt_saman_3.png",
  width = 8, height = 1.2 * 8, scale = 1.3
)

caption <- "Mynd eftir @bggjonsson hjá metill.is byggð á gögnum OECD um fólksflutninga: https://stats.oecd.org/Index.aspx?DataSetCode=MIG\nGögn og kóði: https://github.com/bgautijonsson/Metill.is/tree/master/greinar/flottafolk"
```

![](Figures/samthykkt_saman_3.png){.column-page}




# Innflytjendur og vinnumarkaður

```{r}
plot_dat <- d |> 
  filter(ar < 2021) |> 
  mutate(net = innfluttir - utfluttir) |> 
  drop_na(net) |> 
  mutate(
    colour = case_when(
      land == "Ísland" ~ litur_island,
      land == "Danmörk" ~ litur_danmork,
      land == "Finnland" ~ litur_finnland,
      land == "Noregur" ~ litur_noregur,
      land == "Svíþjóð" ~ litur_svithjod,
      TRUE ~ litur_annad
    ),
    linewidth = 1 * (land == "Ísland"),
    size = as_factor(linewidth)
  )


p1 <- plot_dat |> 
  ggplot(aes(ar, net)) +
  geom_hline(yintercept = 0, lty = 2) +
  geom_line(
    data = plot_dat |> 
      filter(colour == litur_annad),
    aes(group = land, col = colour),
    alpha = 0.5
  ) +
  geom_line(
    data = plot_dat |> 
      filter(colour != litur_annad),
    aes(group = land, col = colour),
    linewidth = 1
  ) +
  geom_text(
    data = plot_dat |> 
      filter(colour != litur_annad, ar == max(ar)) |> 
      mutate(
        net = case_when(
          land == "Svíþjóð" ~ net + 0.65,
          land == "Ísland" ~ net + 0.25,
          land == "Noregur" ~ net - 0.15,
          TRUE ~ net
        )
      ),
    aes(label = land, colour = colour),
    hjust = 0,
    nudge_x = 0.1
  ) +
  scale_x_tufte(
    breaks = tufte_breaks(plot_dat$ar),
    limits = c(2000, 2021)
  ) +
  scale_y_tufte(
    breaks = tufte_breaks(plot_dat$net),
    labels = label_number(accuracy = 1),
    expand = expansion()
  ) +
  scale_colour_identity() +
  theme(
    legend.position = "none",
    axis.title.y = element_text(
      margin = margin(), 
      vjust = -10, 
      colour = theme_metill()$plot.subtitle$colour
    )
  ) +
  labs(
    x = NULL,
    y = "Fjöldi innfluttra - fjöldi útfluttra",
    title = "Árleg breyting á fjölda íbúa með annað ríkisfang á 1.000 innlenda íbúa",
    subtitle = "Reiknuð sem fjöldi erlendra sem flytur til landsins mínur fjöldi sem flytur frá landi"
  )

ggsave(
  plot = p1,
  filename = "Figures/netto_erl.png",
  width = 8, height = 0.5 * 8, scale = 1.3
)

plot_dat <- d |> 
  distinct(land, ar, hlutf_med_vinnu) |> 
  drop_na(hlutf_med_vinnu) |> 
  filter(ar >= 2015) |> 
  group_by(land) |> 
  summarise(hlutf_med_vinnu = mean(hlutf_med_vinnu)) |> 
  ungroup() |> 
  mutate(
    colour = case_when(
      land == "Ísland" ~ litur_island,
      land == "Danmörk" ~ litur_danmork,
      land == "Finnland" ~ litur_finnland,
      land == "Noregur" ~ litur_noregur,
      land == "Svíþjóð" ~ litur_svithjod,
      TRUE ~ litur_annad
    ),
    linewidth = 1 * (land == "Ísland"),
    size = as_factor(linewidth),
    land = glue("<i style='color:{colour}'>{land}</i>"),
    land = fct_reorder(land, hlutf_med_vinnu)
  ) 

p2 <- plot_dat |> 
  ggplot(aes(hlutf_med_vinnu, land, col = colour, size = size)) +
  geom_point() +
  geom_segment(aes(yend = land, xend = 0, linewidth = linewidth), lty = 2, alpha = 0.5) +
  scale_x_continuous(
    expand = expansion(),
    limits = c(0, 1),
    labels = label_percent()
  ) +
  scale_colour_identity() +
  scale_size_manual(values = c(1, 3)) +
  scale_linewidth(
    range = c(0.2, 0.4)
  ) +
  theme(
    plot.margin = margin(t = 5, r = 25, b = 5, l = 5),
    axis.text.y = element_markdown(size = 10, family = "Lato"),
    legend.position = "none"
  ) +
  labs(
    x = NULL,
    y = NULL,
    title = "Hlutfall innflytjenda sem eru með vinnu",
    subtitle = "Meðaltal hlutfalls frá 2015 til 2021"
  )

ggsave(
  plot = p2,
  filename = "Figures/hlutf_med_vinnu_2015_2021.png",
  width = 8, height = 0.5 * 8, scale = 1.3
)

p <- (p2 + labs(title = NULL, subtitle = "Hlutfall innflytjenda sem eru með vinnu (meðaltal 2015 - 2021)")) /
  (p1 + labs(title = NULL, subtitle = "Árleg breyting á fjölda íbúa með erlent ríkisfang per 1.000 innlendir íbúar")) +
  plot_annotation(
    title = "Fjöldi innflytjenda og þátttaka á atvinnumarkaði",
    caption = caption
  )


ggsave(
  plot = p,
  filename = "Figures/vinnandi_saman.png",
  width = 8, height = 0.85 * 8, scale = 1.3
)
```


![](Figures/vinnandi_saman.png){.column-page}

# Veitingar ríkisborgararéttar

```{r}
plot_dat <- d |> 
  filter(ar < 2021) |> 
  select(ar, land, value = nyir_innlendir_rikisborgarar) |> 
  drop_na(value) |> 
  mutate(
    colour = case_when(
      land == "Ísland" ~ litur_island,
      land == "Danmörk" ~ litur_danmork,
      land == "Finnland" ~ litur_finnland,
      land == "Noregur" ~ litur_noregur,
      land == "Svíþjóð" ~ litur_svithjod,
      TRUE ~ litur_annad
    ),
    linewidth = 1 * (land == "Ísland"),
    size = as_factor(linewidth),
    land = fct_reorder(land, value)
  ) 

p1 <- plot_dat |> 
  ggplot(aes(ar, value)) +
  geom_line(
    data = plot_dat |> 
      filter(colour == litur_annad),
    aes(group = land, col = colour),
    alpha = 0.5
  ) +
  geom_line(
    data = plot_dat |> 
      filter(colour != litur_annad),
    aes(group = land, col = colour),
    linewidth = 1
  ) +
  geom_text(
    data = plot_dat |> 
      filter(colour != litur_annad, ar == max(ar)) |> 
      mutate(
        value = case_when(
          land == "Ísland" ~ value - 0.3,
          land == "Finnland" ~ value + 0.3,
          TRUE ~ value
        )
      ),
    aes(label = land, colour = colour),
    hjust = 0,
    nudge_x = 0.1
  ) +
  scale_x_tufte(
    breaks = tufte_breaks(plot_dat$ar),
    limits = c(2000, 2021)
  ) +
  scale_y_tufte(
    breaks = tufte_breaks(plot_dat$value),
    labels = label_number(accuracy = 1),
    expand = expansion()
  ) +
  scale_colour_identity() +
  coord_cartesian(ylim = c(0, 12)) +
  theme(
    legend.position = "none",
    axis.title.y = element_text(
      margin = margin(), 
      vjust = -10, 
      colour = theme_metill()$plot.subtitle$colour
    )
  ) +
  labs(
    x = NULL,
    y = NULL,
    title = "Nýir ríkisborgarar á hverja 1.000 íbúa",
    subtitle = "Tölur byggðar á veitingum til fólks með annað en íslenskan ríkisborgararétt",
    caption = caption
  )

ggsave(
  plot = p1,
  filename = "Figures/rikisborgarar.png",
  width = 8, height = 0.5 * 8, scale = 1.3
)
```

![](Figures/rikisborgarar.png){.column-page}

```{r}
plot_dat <- d |> 
  select(ar, land, value = haelisumsoknir) |> 
  arrange(ar, desc(value)) |> 
  group_by(ar) |> 
  mutate(row = row_number()) |> 
  ungroup() |> 
  filter(
    land %in% c("Ísland", "Noregur", "Svíþjóð", "Danmörk", "Finnland")
  )

p <- plot_dat |> 
  ggplot(aes(ar, row)) +
  geom_line(aes(group = land, col = land)) +
  geom_text(
    data = plot_dat |> 
      filter(ar == max(ar)),
    aes(label = land, col = land),
    hjust = 0,
    nudge_x = 0.1
  ) +
  scale_x_tufte() +
  scale_y_tufte(
    labels = function(x) abs(x),
    breaks = tufte_breaks(plot_dat$row)
  ) +
  scale_colour_manual(
    values = c(
      litur_danmork,
      litur_finnland,
      litur_island,
      litur_noregur,
      litur_svithjod
    )
  ) +
  coord_cartesian(clip = "off", ylim = c(29, 1)) +
  theme(
    legend.position = "none",
    plot.margin = margin(t = 5, r = 35, b = 5, l = 5)
  ) +
  labs(
    x = NULL,
    y = NULL,
    title = "Sætaröðun landa eftir fjölda hælisumsókna á 1.000 íbúa",
    subtitle = "Hér þýðir 1. sæti að landið var með flestar umsóknir og 29. sæti fæstar"
  )

ggsave(
  plot = p,
  filename = "Figures/haelis_saeti.png",
  width = 8, height = 0.5 * 8, scale = 1.3
)
```



```{r}
d <- read_csv("data/flottafolk_manadarlegt.csv") |> 
  mutate(per_pers = flottafjoldi / mannfjoldi * 1000)
```

# Fjöldi flóttafólks í landinu

## Án Úkraínu

```{r}

```


```{r}
caption <- "Mynd eftir @bggjonsson hjá metill.is byggð á gögnum OECD um tímabundna vernd: https://ec.europa.eu/eurostat/databrowser/view/MIGR_ASYTPSM/default/table?lang=en&category=migr.migr_asy.migr_asytp\nGögn og kóði: https://github.com/bgautijonsson/Metill.is/tree/master/greinar/flottafolk"

d_nonUA <- d |> 
  select(land, dags, land_fra, per_pers) |> 
  pivot_wider(names_from = land_fra, values_from = per_pers) |> 
  mutate(per_pers = TOTAL - UA) |> 
  select(land, dags, per_pers)

p1 <- d_nonUA |> 
  filter(dags == min(dags)) |> 
  drop_na(per_pers) |> 
  mutate(
    colour = case_when(
      land == "Ísland" ~ litur_island,
      land == "Danmörk" ~ litur_danmork,
      land == "Finnland" ~ litur_finnland,
      land == "Noregur" ~ litur_noregur,
      land == "Svíþjóð" ~ litur_svithjod,
      TRUE ~ litur_annad
    ),
    linewidth = 1 * (land == "Ísland"),
    size = as_factor(linewidth),
    land = glue("<i style='color:{colour}'>{land}</i>"),
    land = fct_reorder(land, per_pers)
  ) |> 
  ggplot(aes(per_pers, land, col = colour, size = size)) +
  geom_point() +
  geom_segment(aes(yend = land, xend = 0, linewidth = linewidth), lty = 2, alpha = 0.5) +
  scale_x_continuous(
    expand = expansion(),
    limits = c(0, 0.125)
  ) +
  scale_colour_identity() +
  scale_size_manual(values = c(1, 3)) +
  scale_linewidth(
    range = c(0.2, 0.4)
  ) +
  theme(
    plot.margin = margin(t = 5, r = 25, b = 5, l = 5),
    axis.text.y = element_markdown(size = 10, family = "Lato"),
    legend.position = "none"
  ) +
  labs(
    x = NULL,
    y = NULL,
    title = "Hvar njóta flestir einstaklingar tímabundinnar verndar?",
    subtitle = "Fjöldi í mars 2022",
    caption = caption
  )


ggsave(
  plot = p1,
  filename = "Figures/vernd_mars_nonUA.png",
  width = 8, height = 0.5 * 8, scale = 1.3
)

p2 <- d_nonUA |> 
  filter(month(dags) == 9) |> 
  drop_na(per_pers) |> 
  mutate(
    colour = case_when(
      land == "Ísland" ~ litur_island,
      land == "Danmörk" ~ litur_danmork,
      land == "Finnland" ~ litur_finnland,
      land == "Noregur" ~ litur_noregur,
      land == "Svíþjóð" ~ litur_svithjod,
      TRUE ~ litur_annad
    ),
    linewidth = 1 * (land == "Ísland"),
    size = as_factor(linewidth),
    land = glue("<i style='color:{colour}'>{land}</i>"),
    land = fct_reorder(land, per_pers)
  ) |> 
  ggplot(aes(per_pers, land, col = colour, size = size)) +
  geom_point() +
  geom_segment(aes(yend = land, xend = 0, linewidth = linewidth), lty = 2, alpha = 0.5) +
  scale_x_continuous(
    expand = expansion(),
    limits = c(0, 1.1),
    breaks = c(0, 0.25, 0.5, 0.75, 1, 1.1)
  ) +
  scale_colour_identity() +
  scale_size_manual(values = c(1, 3)) +
  scale_linewidth(
    range = c(0.2, 0.4)
  ) +
  theme(
    plot.margin = margin(t = 5, r = 25, b = 5, l = 5),
    axis.text.y = element_markdown(size = 10),
    legend.position = "none"
  ) +
  labs(
    x = NULL,
    y = NULL,
    title = "Hvar njóta flestir einstaklingar tímabundinnar verndar?",
    subtitle = "Fjöldi í september 2022",
    caption = caption
  )

ggsave(
  plot = p2,
  filename = "Figures/vernd_september_nonUA.png",
  width = 8, height = 0.5 * 8, scale = 1.3
)

p <- (p1 + labs(title = NULL, caption = NULL)) + 
  (p2 + labs(title = NULL, caption = NULL)) +
  plot_annotation(
    title = "Hvar njóta flestir einstaklingar tímabundinnar verndar?",
    caption = caption
  )

ggsave(
  plot = p,
  filename = "Figures/vernd_saman_nonUA.png",
  width = 8, height = 0.5 * 8, scale = 1.3
)

plot_dat <- d_nonUA |> 
  filter(month(dags) < 10) |> 
  drop_na(per_pers) |> 
  select(dags, land, value = per_pers) |> 
  mutate(
    colour = case_when(
      land == "Ísland" ~ litur_island,
      land == "Danmörk" ~ litur_danmork,
      land == "Finnland" ~ litur_finnland,
      land == "Noregur" ~ litur_noregur,
      land == "Svíþjóð" ~ litur_svithjod,
      TRUE ~ litur_annad
    ),
    linewidth = 1 * (land == "Ísland"),
    size = as_factor(linewidth)
  )

p3 <- plot_dat |> 
  ggplot(aes(dags, value)) +
  geom_line(
    data = plot_dat |> 
      filter(colour == litur_annad),
    aes(group = land, colour = litur_annad),
    alpha = 0.3,
    col = litur_annad
  ) +
  geom_line(
    data = plot_dat |> 
      filter(colour != litur_annad),
    aes(group = land, colour = colour),
    linewidth = 1
  ) +
  geom_text(
    data = plot_dat |> 
      filter(colour != litur_annad, dags == max(dags)) |> 
      mutate(
        value = case_when(
          land == "Svíþjóð" ~ value + 0.045,
          land == "Ísland" ~ value - 0.023,
          land == "Noregur" ~ value - 0.013,
          land == "Danmörk" ~ value + 0.032,
          land == "Finnland" ~ value + 0.01,
          TRUE ~ value
        )
      ),
    aes(label = land, colour = colour),
    hjust = 0,
    nudge_x = 1
  ) +
  scale_x_date(
    breaks = unique(plot_dat$dags),
    labels = c(
      "Mars", "Apríl", "Maí", "Júní", "Júlí", "Ágúst", "September"
    )
  ) +
  geom_rangeframe(sides = "b") +
  scale_y_tufte(
    breaks = tufte_breaks(plot_dat$value),
    labels = label_number(accuracy = ),
    limits = c(0, NA),
    expand = expansion()
  ) +
  scale_colour_identity() +
  coord_cartesian(ylim = c(0, NA), clip = "off") +
  theme(
    axis.line.x = element_blank(),
    plot.margin = margin(t = 5, r = 35, b = 5, l = 5)
  ) +
  labs(
    x = NULL,
    y = NULL,
    subtitle = "Fjöldi eftir mánuði"
  )

p <- (
  (p1 + labs(title = NULL, caption = NULL)) + 
    (p2 + labs(title = NULL, caption = NULL))
)/
  p3 +
  plot_annotation(
    title = "Hvar njóta flestir einstaklingar tímabundinnar verndar? (Án flóttafólks frá Úkraínu)",
    subtitle = "Sýnt sem fjöldi á 1.000 íbúa hvers lands",
    caption = caption
  )

ggsave(
  plot = p,
  filename = "Figures/vernd_saman_2_nonUA.png",
  width = 8, height = 1 * 8, scale = 1.3
)
```


## Alls

```{r}
d |> 
  rename(dags = time) |> 
  mutate(land_fra = "TOTAL")
```


```{r}
caption <- "Mynd eftir @bggjonsson hjá metill.is byggð á gögnum OECD um tímabundna vernd: https://ec.europa.eu/eurostat/databrowser/view/MIGR_ASYTPSM/default/table?lang=en&category=migr.migr_asy.migr_asytp\nGögn og kóði: https://github.com/bgautijonsson/Metill.is/tree/master/greinar/flottafolk"

p1 <- d |> 
  rename(
    dags = time, 
    flottafjoldi = beneficiaries,
    per_pers = per_pop
    ) |> 
  mutate(land_fra = "TOTAL") |> 
  filter(dags == min(dags),
         land_fra == "TOTAL") |> 
  drop_na(flottafjoldi) |> 
  mutate(
    colour = case_when(
      land == "Ísland" ~ litur_island,
      land == "Danmörk" ~ litur_danmork,
      land == "Finnland" ~ litur_finnland,
      land == "Noregur" ~ litur_noregur,
      land == "Svíþjóð" ~ litur_svithjod,
      TRUE ~ litur_annad
    ),
    linewidth = 1 * (land == "Ísland"),
    size = as_factor(linewidth),
    land = glue("<i style='color:{colour}'>{land}</i>"),
    land = fct_reorder(land, per_pers)
  ) |> 
  ggplot(aes(per_pers, land, col = colour, size = size)) +
  geom_point() +
  geom_segment(aes(yend = land, xend = 0, linewidth = linewidth), lty = 2, alpha = 0.5) +
  scale_x_continuous(
    expand = expansion(),
    limits = c(0, 20)
  ) +
  scale_colour_identity() +
  scale_size_manual(values = c(1, 3)) +
  scale_linewidth(
    range = c(0.2, 0.4)
  ) +
  theme(
    plot.margin = margin(t = 5, r = 25, b = 5, l = 5),
    axis.text.y = element_markdown(size = 10, family = "Lato"),
    legend.position = "none"
  ) +
  labs(
    x = NULL,
    y = NULL,
    title = "Hvar njóta flestir einstaklingar tímabundinnar verndar?",
    subtitle = "Fjöldi í mars 2022",
    caption = caption
  )


ggsave(
  plot = p1,
  filename = "Figures/vernd_mars.png",
  width = 8, height = 0.5 * 8, scale = 1.3
)

p2 <- d |> 
  rename(
    dags = time, 
    flottafjoldi = beneficiaries,
    per_pers = per_pop
    ) |> 
  mutate(land_fra = "TOTAL") |> 
  filter(month(dags) == 10,
         land_fra == "TOTAL") |> 
  drop_na(per_pers) |> 
  mutate(
    colour = case_when(
      land == "Ísland" ~ litur_island,
      land == "Danmörk" ~ litur_danmork,
      land == "Finnland" ~ litur_finnland,
      land == "Noregur" ~ litur_noregur,
      land == "Svíþjóð" ~ litur_svithjod,
      TRUE ~ litur_annad
    ),
    linewidth = 1 * (land == "Ísland"),
    size = as_factor(linewidth),
    land = glue("<i style='color:{colour}'>{land}</i>"),
    land = fct_reorder(land, per_pers)
  ) |> 
  ggplot(aes(per_pers, land, col = colour, size = size)) +
  geom_point() +
  geom_segment(aes(yend = land, xend = 0, linewidth = linewidth), lty = 2, alpha = 0.5) +
  scale_x_continuous(
    expand = expansion(),
    limits = c(0, 30)
  ) +
  scale_colour_identity() +
  scale_size_manual(values = c(1, 3)) +
  scale_linewidth(
    range = c(0.2, 0.4)
  ) +
  theme(
    plot.margin = margin(t = 5, r = 25, b = 5, l = 5),
    axis.text.y = element_markdown(size = 10),
    legend.position = "none"
  ) +
  labs(
    x = NULL,
    y = NULL,
    title = "Hvar njóta flestir einstaklingar tímabundinnar verndar?",
    subtitle = "Fjöldi í október 2022",
    caption = caption
  )

ggsave(
  plot = p2,
  filename = "Figures/vernd_september.png",
  width = 8, height = 0.5 * 8, scale = 1.3
)

p <- (p1 + labs(title = NULL, caption = NULL)) + 
  (p2 + labs(title = NULL, caption = NULL)) +
  plot_annotation(
    title = "Hvar njóta flestir einstaklingar tímabundinnar verndar?",
    caption = caption
  )

ggsave(
  plot = p,
  filename = "Figures/vernd_saman.png",
  width = 8, height = 0.5 * 8, scale = 1.3
)

plot_dat <- d |> 
  arrange(time) |> 
  rename(
    dags = time, 
    flottafjoldi = beneficiaries,
    per_pers = per_pop
    ) |> 
  mutate(land_fra = "TOTAL") |> 
  filter(month(dags) <= 12,
         land_fra == "TOTAL") |> 
  drop_na(per_pers) |> 
  select(dags, land, value = per_pers) |> 
  mutate(
    colour = case_when(
      land == "Ísland" ~ litur_island,
      land == "Danmörk" ~ litur_danmork,
      land == "Finnland" ~ litur_finnland,
      land == "Noregur" ~ litur_noregur,
      land == "Svíþjóð" ~ litur_svithjod,
      TRUE ~ litur_annad
    ),
    linewidth = 1 * (land == "Ísland"),
    size = as_factor(linewidth)
  )

p3 <- plot_dat |> 
  ggplot(aes(dags, value)) +
  geom_line(
    data = plot_dat |> 
      filter(colour == litur_annad),
    aes(group = land, colour = litur_annad),
    alpha = 0.3,
    col = litur_annad
  ) +
  geom_line(
    data = plot_dat |> 
      filter(colour != litur_annad),
    aes(group = land, colour = colour),
    linewidth = 1
  ) +
  geom_text(
    data = plot_dat |> 
      group_by(land) |> 
      filter(colour != litur_annad, dags == max(dags)) |> 
      ungroup() |> 
      mutate(
        value = case_when(
          land == "Svíþjóð" ~ value - 0.8,
          land == "Ísland" ~ value - 0.2,
          land == "Noregur" ~ value + 0.3,
          land == "Danmörk" ~ value + 1,
          land == "Finnland" ~ value + 0.5,
          TRUE ~ value
        )
      ),
    aes(label = land, colour = colour),
    hjust = 0,
    nudge_x = 1
  ) +
  scale_x_date(
    breaks = unique(plot_dat$dags),
    labels = c(
      "Mars", "Apríl", "Maí", 
      "Júní", "Júlí", 
      "Ágúst", "September", 
      "Október", "Nóvember", "Desember"
    )
  ) +
  geom_rangeframe(sides = "b") +
  scale_y_tufte(
    breaks = tufte_breaks(plot_dat$value),
    labels = label_number(accuracy = 1),
    limits = c(0, NA),
    expand = expansion()
  ) +
  scale_colour_identity() +
  coord_cartesian(ylim = c(0, NA), clip = "off") +
  theme(
    axis.line.x = element_blank(),
    plot.margin = margin(t = 5, r = 35, b = 5, l = 5)
  ) +
  labs(
    x = NULL,
    y = NULL,
    subtitle = "Fjöldi eftir mánuði"
  )

p <- (
  (p1 + labs(title = NULL, caption = NULL)) + 
    (p2 + labs(title = NULL, caption = NULL))
)/
  p3 +
  plot_annotation(
    title = "Hvar njóta flestir einstaklingar tímabundinnar verndar?",
    subtitle = "Sýnt sem fjöldi á 1.000 íbúa hvers lands",
    caption = caption
  )

ggsave(
  plot = p,
  filename = "Figures/vernd_saman_2.png",
  width = 8, height = 1 * 8, scale = 1.3
)
```
