{"title":"Vinnumarkaður","markdown":{"yaml":{"title":"Vinnumarkaður","pagetitle":"Vinnumarkaður","subtitle":"Hver er fjöldi starfandi einstaklinga og hvernig skiptast þeir á vinnumarkaði?","description":"Reglulega sjást fyrirsagnir þar sem talað er um að opinbert starfsfólk sé allt of margt og að hlutfall þess af heildarfjölda vinnandi fólks sé of hátt. Hér kryf ég reglulega nýjustu gögnin til að geta vitað hvort slíkar fullyrðingar séu teknar úr samhengi eða endurspegli raunveruleikann.\n","author":[{"name":"Brynjólfur Gauti Guðrúnar Jónsson","url":"https://twitter.com/bgautijonsson","affiliation":"Tölfræði, Raunvísindadeild Háskóla Íslands","affiliation-url":"https://www.hi.is/tolfraedi_0"}],"date":"2022/09/10","format":{"html":{"code-fold":true,"smooth-scroll":true,"link-external-newwindow":true}},"execute":{"echo":false,"warning":false,"cache":false},"editor":"source","title-block-banner":true,"categories":["efnahagur","vinnumarkaður","Hagstofa","R","íslenska"],"image":"hlutf_opinbert.png","twitter-card":{"image":"hlutf_opinbert.png"}},"headingText":"| include: false","containsRefs":false,"markdown":"\n\n\n```{r}\n#| cache: false\n\nlibrary(cowplot)\nlibrary(tidyverse)\nlibrary(scales)\nlibrary(pxweb)\nlibrary(ggthemes)\nlibrary(kableExtra)\nlibrary(gganimate)\nlibrary(lubridate)\nlibrary(geomtextpath)\nlibrary(ggtext)\nlibrary(here)\nlibrary(readxl)\nlibrary(janitor)\nlibrary(mgcv)\nlibrary(emmeans)\nlibrary(broom)\nlibrary(metill)\n\ntheme_set(theme_metill())\n```\n\n# Gögn\n\nHér nota ég gögn frá Hagstofunni um [Fjölda starfandi í rekstrarformum samkvæmt skrám eftir mánuðum, kyni, aldri og bakgrunni 2008-2022](https://px.hagstofa.is/pxis/pxweb/is/Samfelag/Samfelag__vinnumarkadur__vinnuaflskraargogn/VIN10052.px).\n\n```{r}\nurl <- \"https://px.hagstofa.is:443/pxis/api/v1/is/Samfelag/vinnumarkadur/vinnuaflskraargogn/VIN10052.px\"\n\npx_vars <- pxweb_get(url)\n\nquery_list <- list(  \n    \"Mánuður\" = c(\"*\"),  \n    \"Aldur\" = c(\"0\"),  \n    \"Rekstrarform\" = c(\"*\"),  \n    \"Kyn\" = c(\"0\"),  \n    \"Bakgrunnur\" = c(\"*\"),  \n    \"Lögheimili\" = c(\"0\")\n    \n)\n\nd <- pxweb_get(url, query = pxweb_query(query_list), verbose = FALSE) |>  \n    as.data.frame() |>  \n    as_tibble() |>  \n    janitor::clean_names() |>  \n    separate(manudur, into = c(\"ar\", \"manudur\"), sep = \"M\") |>  \n    mutate(dags = str_c(ar, \"-\", manudur, \"-01\") |> ymd()) |>  \n    select(dags, kyn, rekstrarform, starfandi, bakgrunnur) |>  \n    drop_na() |>  \n    mutate(tegund = case_when(str_detect(rekstrarform, \"^B2\") ~ \"Opinbert\",\n                              str_detect(rekstrarform, \"^K1\") ~ \"Opinbert\",  \n                              str_detect(rekstrarform, \"^K2\") ~ \"Opinbert\",  \n                              TRUE ~ \"Annad\")) |> \n    select(-kyn)\n```\n\n\n# Fjöldi starfandi\n\n:::{.panel-tabset}\n\n## Almennur vinnumarkaður\n\n```{r}\n#| fig-width: 12\n#| fig-asp: 0.621\n#| out-width: \"100%\"\n#| column: page\n\n\nplot_dat <-  d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |>  \n    filter(year(dags) >= 2008)\n\np <- plot_dat |> \n    ggplot(aes(dags, Annad)) +  \n    geom_line() +  \n    scale_x_date(date_breaks = \"1 year\", date_labels = \"%Y\",   \n                 expand = expansion()) +  \n    scale_y_tufte(breaks = tufte_breaks(plot_dat$Annad),\n                  limits = c(1e5, 1.5e5),\n                  labels = label_number()) +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Fjöldi starfandi á almennum vinnumarkaði\") +\n    theme(plot.margin = margin(t = 5, r = 20, b = 5, l = 5))\n\np\n```\n\n## Opinber vinnumarkaður\n\n```{r}\n#| fig-width: 12\n#| fig-asp: 0.621\n#| out-width: \"100%\"\n#| column: page\n\n\nplot_dat <-  d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n)\n\np <- plot_dat |> \n    ggplot(aes(dags, Opinbert)) +  \n    geom_line() +  \n    scale_x_date(date_breaks = \"1 year\", date_labels = \"%Y\",   \n                 expand = expansion()) +  \n    scale_y_tufte(breaks = tufte_breaks(plot_dat$Opinbert),\n                  labels = label_number()) +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Fjöldi opinbers starfsfólks\") +\n    theme(plot.margin = margin(t = 5, r = 20, b = 5, l = 5))\n\np\n```\n\n## Saman\n\n```{r}\n#| fig-width: 12\n#| fig-asp: 0.621\n#| out-width: \"100%\"\n#| column: page\n\n\nplot_dat <-  d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    mutate(tegund = fct_recode(as_factor(tegund),\n                               \"Opinber\" = \"Opinbert\",\n                               \"Almennur\" = \"Annad\"))\n\np <- plot_dat |> \n    ggplot(aes(dags, n)) +  \n    geom_line(aes(col = tegund)) +\n    geom_text(data = plot_dat |> filter(dags == max(dags)),\n              aes(label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n    scale_x_date(date_breaks = \"year\", date_labels = \"%Y\",  \n                 expand = expansion(add = 31),\n                 limits = c(min(plot_dat$dags), max(plot_dat$dags) + 15)) +  \n    scale_y_tufte(breaks = tufte_breaks(plot_dat$n),\n                  labels = label_number(),\n                  limits = c(0, 1.5e5),\n                  expand = expansion()) +\n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Fjöldi starfandi á almennum og opinberum vinnumarkaði\") +\n    theme(plot.margin = margin(t = 5, r = 60, b = 5, l = 5),\n          legend.position = \"none\")\n\np\n```\n:::\n\n# Fjöldi miðað við fyrri ár\n\n:::{.panel-tabset}\n\n## Almennur\n\n:::{.panel-tabset}\n\n### 2017\n\n```{r}\n#| fig-width: 12\n#| fig-asp: 0.621\n#| out-width: \"100%\"\n#| column: page\n\n\nplot_dat <- d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |>  \n    filter(year(dags) >= 2017) |>  \n    mutate(manudur = month(dags)) |>  \n    group_by(manudur) |>  \n    mutate(breyting = Annad - Annad[year(dags) == min(year(dags))]) |> \n    ungroup()\n\np <- plot_dat |> \n    ggplot(aes(dags, breyting)) +  \n    geom_vline(xintercept = ymd(c(\"2018-01-01\", \"2019-01-01\", \"2020-01-01\", \"2021-01-01\", \"2022-01-01\")), lty = 2, alpha = 0.3) +\n    geom_hline(yintercept = 0, lty = 2) +  \n    geom_line() +  \n    scale_x_date(date_breaks = \"3 months\", date_labels = \"%b/%y\",  \n                 guide = guide_axis(n.dodge = 2),  \n                 expand = expansion()) +  \n    scale_y_tufte(breaks = tufte_breaks(plot_dat$breyting),\n                  labels = label_number(),\n                  limits = c(-1.8e4, 1e4)) +  \n    labs(x = NULL, y = NULL,  \n         title = \"Fjöldi starfandi á almennum vinnumarkaði miðað við sama mánuð 2017\",\n         subtitle = \"Janúar 2022 var fyrsti mánuður frá upphafi faraldurs COVID-19 þar sem fleiri unnu á almennum markaði en sama mánuð 2017\") +  \n    theme(plot.margin = margin(t = 5, r = 20, b = 5, l = 5))\n\np\n```\n\n### 2019\n\n```{r}\n#| fig-width: 12\n#| fig-asp: 0.621\n#| out-width: \"100%\"\n#| column: page\n\n\nplot_dat <- d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |>  \n    filter(year(dags) >= 2019) |>  \n    mutate(manudur = month(dags)) |>  \n    group_by(manudur) |>  \n    mutate(breyting = Annad - Annad[year(dags) == min(year(dags))]) |> \n    ungroup()\n\np <- plot_dat |> \n    ggplot(aes(dags, breyting)) +  \n    geom_vline(xintercept = ymd(c(\"2020-01-01\", \"2021-01-01\", \"2022-01-01\")), lty = 2, alpha = 0.3) +\n    geom_hline(yintercept = 0, lty = 2) +  \n    geom_line() +  \n    scale_x_date(date_breaks = \"3 months\", date_labels = \"%b/%y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion()) +  \n    scale_y_tufte(breaks = tufte_breaks(plot_dat$breyting),\n                  labels = label_number(big.mark = \".\", decimal.mark = \",\"),\n                  limits = c(-1.8e4, NA)) +  \n    \n    labs(x = NULL, y = NULL,  \n         title = \"Fjöldi starfandi á almennum vinnumarkaði miðað við sama mánuð 2019\",\n         subtitle = \"Mars 2022 var annar mánuður frá 2020 þar sem fleiri unnu á almennum markaði en sama mánuð 2019\") +  \n    theme(plot.margin = margin(t = 5, r = 20, b = 5, l = 5))\n\np\n```\n\n:::\n\n## Hlutfall Opinbert\n\n:::{.panel-tabset}\n\n### 2017\n\n```{r}\n#| fig-width: 12\n#| fig-asp: 0.621\n#| out-width: \"100%\"\n#| column: page\n\n\nplot_dat <- d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |>  \n    filter(year(dags) >= 2017) |>  \n    mutate(manudur = month(dags),\n           hlutf = Opinbert / (Annad + Opinbert)) |> \n    ungroup() |> \n    group_by(manudur) |>  \n    mutate(breyting = hlutf - hlutf[year(dags) == min(year(dags))]) |> \n    ungroup()\n\np <- plot_dat |> \n    ggplot(aes(dags, breyting)) +  \n    geom_vline(xintercept = ymd(c(\"2018-01-01\", \"2019-01-01\", \"2020-01-01\", \"2021-01-01\", \"2022-01-01\")), lty = 2, alpha = 0.3) +\n    geom_line() +  \n    scale_x_date(date_breaks = \"3 months\", date_labels = \"%b\\n%y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion()) + \n    scale_y_tufte(breaks = tufte_breaks(plot_dat$breyting),\n                  labels = label_percent(accuracy = 0.1)) +  \n    \n    labs(x = NULL, y = NULL,  \n         title = \"Munur á hlutfalli opinbers starfsfólks frá sama mánuði 2017\") +\n    theme(plot.margin = margin(t = 5, r = 20, b = 5, l = 5))\n\np\n```\n\n### 2019\n\n```{r}\n#| fig-width: 12\n#| fig-asp: 0.621\n#| out-width: \"100%\"\n#| column: page\n\n\nplot_dat <- d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |>  \n    filter(year(dags) >= 2019) |>  \n    mutate(manudur = month(dags),\n           hlutf = Opinbert / (Annad + Opinbert)) |> \n    ungroup() |> \n    group_by(manudur) |>  \n    mutate(breyting = hlutf - hlutf[year(dags) == min(year(dags))]) |> \n    ungroup()\n\np <- plot_dat |> \n    ggplot(aes(dags, breyting)) +  \n    geom_vline(xintercept = ymd(c(\"2020-01-01\", \"2021-01-01\", \"2022-01-01\")), lty = 2, alpha = 0.3) +\n    geom_line() +  \n    scale_y_tufte(breaks = tufte_breaks(plot_dat$breyting),\n                  labels = label_percent(accuracy = 0.1)) +  \n    scale_x_date(date_breaks = \"3 months\", date_labels = \"%b\\n%y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion()) +  \n    labs(x = NULL, y = NULL,  \n         title = \"Munur á hlutfalli opinbers starfsfólks frá sama mánuði 2019\") +  \n    theme(plot.margin = margin(t = 5, r = 20, b = 5, l = 5),\n          plot.title = element_text(face = \"bold\"))\n\np\n```\n\n:::\n\n:::\n\n# Árstíðaleiðrétt hlutfall opinbers starfsfólks\n\n:::{.panel-tabset}\n\n## Mynd\n\n```{r}\n#| fig-width: 12\n#| fig-asp: 0.621\n#| out-width: \"100%\"\n#| column: screen-inset\n\n\nmodel_dat <- d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |>  \n    mutate(Heild = Opinbert + Annad) |> \n    filter(year(dags) >= 2008) |>  \n    mutate(manudur = month(dags),\n           timi = as.numeric(as.factor(dags)),\n           hlutf = Opinbert / (Annad + Opinbert)) |> \n    ungroup()\n\nm <- gam(Opinbert ~ s(manudur, bs = \"cc\") + s(timi, bs = \"ad\"), \n         data = model_dat, offset = log(Heild), family = nb(), method = \"REML\")\n\nplot_dat <- emmeans(m, ~ timi + manudur, at = list(timi = model_dat$timi,\n                                                   manudur = 1:12)) |> \n    tidy(type = \"response\") |> \n    group_by(timi) |> \n    mutate(wt = 1 / std.error,\n           wt = wt / sum(wt)) |> \n    summarise(response = sum(response * wt)) |> \n    inner_join(\n        model_dat,\n        by = \"timi\"\n    )\n\n\nopinbert_dat <- gam(Opinbert ~ s(manudur, bs = \"cc\") + s(timi, bs = \"ad\"), data = model_dat,\n                    family = nb(), method = \"REML\") |> \n    emmeans(~ timi, at = list(timi = unique(model_dat$timi))) |> \n    tidy() |> \n    inner_join(\n        model_dat |> \n            distinct(timi, dags)\n    ) |> \n    mutate(change = c(0, diff(estimate)),\n           perc_change = exp(change))\n\n\nalm_dat <- gam(Annad ~ s(manudur, bs = \"cc\") + s(timi, bs = \"ad\"), data = model_dat,\n               family = nb(), method = \"REML\") |> \n    emmeans(~ timi, at = list(timi = unique(model_dat$timi))) |> \n    tidy() |> \n    inner_join(\n        model_dat |> \n            distinct(timi, dags)\n    ) |> \n    mutate(change = c(0, diff(estimate)),\n           perc_change = exp(change))\n\n\nheild_dat <- gam(Heild ~ s(manudur, bs = \"cc\") + s(timi, bs = \"ad\"), data = model_dat,\n                 family = nb(), method = \"REML\") |> \n    emmeans(~ timi, at = list(timi = unique(model_dat$timi))) |> \n    tidy() |> \n    inner_join(\n        model_dat |> \n            distinct(timi, dags)\n    ) |> \n    mutate(change = c(0, diff(estimate)),\n           perc_change = exp(change))\n\nplot_dat2 <- heild_dat |> \n    mutate(tegund = \"Heild\") |> \n    bind_rows(\n        opinbert_dat |> \n            mutate(tegund = \"Opinber\")\n    )\n\n\ndates <- c(\"2009-08-01\", \"2018-01-01\", \"2021-01-01\")\n\np1 <- plot_dat |> \n    ggplot(aes(dags, hlutf)) +  \n    geom_vline(xintercept = ymd(dates), lty = 2, alpha = 0.5) +\n    geom_line(aes(y = hlutf), alpha = 0.1) +\n    geom_line(aes(y = response)) +  \n    scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n                 date_labels = \"%Y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), max(plot_dat$dags) + 20)) +\n    scale_y_tufte(breaks = tufte_breaks(plot_dat$hlutf),\n                  labels = label_percent(accuracy = 0.01)) +  \n    labs(x = NULL, y = NULL,  \n         title = \"Breytist hlutfall opinbers starfsfólks vegna opinbers eða almenns markaðar?\",\n         subtitle = \"Hlutfall opinbers starfsfólks af vinnumarkaði\") +  \n    theme(plot.margin = margin(t = 5, r = 60, b = 5, l = 5),\n          axis.line.x = element_blank(),\n          axis.text.x = element_blank(),\n          axis.ticks.x = element_blank())\n\np2 <- plot_dat2 |> \n    ggplot(aes(dags, perc_change)) +\n    geom_vline(xintercept = ymd(dates), lty = 2, alpha = 0.5) +\n    geom_hline(yintercept = 1, lty = 2) +\n    geom_line(aes(col = tegund)) +\n    geom_text(\n        data = plot_dat2 |> \n            filter(dags == max(dags)) |> \n            mutate(\n                y = case_when(\n                    tegund == \"Opinber\" ~ perc_change + 0.0004,\n                    tegund == \"Heild\" ~ perc_change - 0.0003,\n                )\n            ),\n        aes(y = y, label = tegund, col = tegund),\n        hjust = 0, nudge_x = 20\n    ) +\n    scale_x_date(date_breaks = \"year\", date_labels = \"%Y\", \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), max(plot_dat$dags) + 20)) +\n    scale_y_tufte(labels = function(x) percent(x - 1, prefix = \" \"),\n                  breaks = c(1, range(plot_dat2$perc_change), 1.005, 0.995),\n                  trans = \"log10\") +\n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    coord_cartesian(clip = \"off\") +\n    theme(plot.margin = margin(t = 0, r = 60, b = 5, l = 5),\n          legend.position = \"none\",\n          plot.subtitle = element_text(margin = margin(t = 0, r = 0, b = 10, l = 0))) +\n    labs(x = NULL,\n         y = NULL,\n         subtitle = \"Mánaðarleg hlutfallsleg breyting fjölda starfsfólks\")\n\n\np <- plot_grid(p1, p2, ncol = 1)\n\np\n\n\nggsave(plot = p, filename = \"hlutf_opinbert.png\",\n       width = 8, height = 0.621 * 8, scale = 1.3, bg = \"white\")\n```\n\n## Aðferð\n\n:::{.panel-tabset}\n\n### Leiðrétting fyrir árstíðarsveiflum\n\nVið getum hugsað að þetta séu tvö ferli:\n\n1. Langtímaferli sem breytist án mjög ákveðins mynsturs\n2. Árstíðabundnar sveiflur sem eru að mestu leyti svipaðar frá ári til árs\n\nNotum GAM *(Generalized Additive Models)* til að meta bæði ferlin saman. Splæsibrúunin *(e. splines)* metur ferlið í tveimur hlutum, línulegum og ólínulegum, og notar stika til að toga ólínulega hlutann í átt að línulegu ferli.\n\n1. Þar sem hæga þróunin getur verið að breytast mishratt á mismunandi árabilum notum við aðlögunarsplæsibrúun *(e. adaptive smoother)* þar sem ólínulegi stikinn fær að breytast með tíma. Í kóðanum er þetta táknað með `s(timi, bs = \"ad\")`\n\n2. Árstíðarferlið hefur þær skorður að frávikið í upphafi og byrjun ársins á að stefna í sömu tölu, þ.e. $\\text{31. desember} \\approx \\text{1. janúar}$. Pakkinn `mgcv` býður upp á slíka hringrásarsplæsara *(e. cyclic smooths)* *[alveg í ruglinu með íslenskuna núna]*. Í kóðanum er þetta táknað með `s(manudur, bs = \"cc\")`\n\nÞegar við erum komin með mat á þessi tvö ferli er lítið mál að heilda yfir árstíðarbundnu sveiflurnar. Við vigtum árstíðarbundna matið eftir nákvæmni matsins í hverjum mánuði *(einum deilt með staðalvillu matsins)* og reiknum svo meðaltal eftir því.\n\nAllt í allt metum við þá líkanið svona *(einfölduð útgáfa af kóða)*:\n\n`gam(Opinbert ~ s(manudur, bs = \"cc\") + s(timi, bs = \"ad\"), offset = log(Heild), family = nb())`\n\nFjöldi opinbers starfsfólks er jákvæð fjöldatala svo fyrsta ágískunin er alltaf [neikvæða tvíkostadreifingin](https://en.wikipedia.org/wiki/Negative_binomial_distribution). Við metum líkanið á lograkvarða, bæði því það er náttúrulega matið fyrir dreifinguna, en líka því við búumst við því að útkoman breytist hlutfallslega milli ára. \n\nHér fyrir neðan sjáum við svo matið á árstíðaráhrifum:\n\n```{r}\n#| fig-width: 12\n#| fig-asp: 1.3\n#| out-width: \"100%\"\n#| column: page\n\n\nplot_dat <- emmeans(m, ~ manudur, at = list(manudur = seq(1, 12, length.out = 100))) |> \n    tidy(type = \"response\") |> \n    mutate(response = exp(log(response) - mean(log(response))))\n\nplot_dat |> \n    ggplot(aes(manudur, response)) +\n    geom_hline(yintercept = 1, lty = 2) +\n    geom_line() +\n    scale_x_tufte(breaks = 1:12,\n                  labels = c(\"Janúar\", \"Febrúar\", \"Mars\",\n                             \"Apríl\", \"Maí\", \"Júní\",\n                             \"Júli\", \"Ágúst\", \"September\",\n                             \"Október\", \"Nóvember\", \"Desember\")) +\n    scale_y_tufte(labels = function(x) percent(x - 1),\n                  breaks = tufte_breaks(plot_dat$response),\n                  limits = c(0.92, 1.08)) +\n    labs(x = \"Mánuður\",\n         y = \"Árstíðarbundnar sveiflur\",\n         title = \"Árstíðarsveiflur í hlutfalli opinbers starfsfólks\")\n```\n\n\n### Teljarinn og nefnarinn\n\nHlutall *(p)* opinbers starfsfólks *(O)* af heildarfjölda starfsfólks *(H)* má skrifa\n\n$$\np = \\frac{O}{H},\n$$\n\nÞar sem $H$ inniheldur líka starfsfólk á almennum vinnumarkaði *(A)*, s.s. $H = O + A$. \n\nSkoðum hlutfallið á tveimur mismunandi tímapunktum, $p_1$ og $p_2$.\n\n$$\n\\frac{p_2}{p_1} = \\frac{O_2/H_2}{O_1/H_1} = \\frac{O_2/O_1}{H_2/H_1}.\n$$\n\nEf $p_2 > p_1$ og $p_1 \\neq 0$ gildir að $p_2/p_1 > 1$ og því\n\n$$\n\\begin{aligned}\n\\frac{O_2/O_1}{H_2/H_1} &> 1 \\\\\n\\rightarrow \\frac{O_2}{O_1} &> \\frac{H_2}{H_1},\n\\end{aligned}\n$$\n\nþ.e. fjöldi opinbers starfsfólks hefur vaxið hlutfallslega hraðar en fjöldi starfsfólks alls. \n\nÞetta er kannski augljóst, en það er gott að hafa þetta í huga þegar hlutfallið hækkar og athuga hvort það sé vegna mikilla opinberra ráðninga eða fækkunar starfa á almennum vinnumarkaði.\n\nHér nota ég *GAM* til að smootha gögnin og nota svo árstíðaleiðrétt smooth gögn til að reikna stöðugar mánaðarlegar breytingar og teiknum þær svo.\n\n:::\n\n:::\n\n\n# Árlegar breytingar\n\n:::{.panel-tabset}\n\n## Hrein breyting\n\n```{r}\n#| fig-width: 12\n#| fig-asp: 0.621\n#| out-width: \"100%\"\n#| column: page\n\n\nplot_dat <- d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |> \n    mutate(Heild = Annad + Opinbert) |> \n    pivot_longer(c(-dags), names_to = \"tegund\", values_to = \"n\") |> \n    filter(year(dags) >= 2008) |>  \n    mutate(manudur = month(dags)) |>\n    group_by(manudur, tegund) |>  \n    mutate(breyting = c(0, diff(n)),\n           uppsofnud_breyting = cumsum(breyting)) |> \n    ungroup() |> \n    filter(year(dags) > min(year(dags))) |> \n    mutate(tegund = fct_recode(tegund,\n                               \"Almennur\" = \"Annad\",\n                               \"Opinber\" = \"Opinbert\"))\n\np <- plot_dat |> \n    ggplot(aes(dags, breyting)) +  \n    # geom_vline(xintercept = ymd(seq.Date(from = min(plot_dat$dags),\n    #                                      to = ymd(\"2022-01-01\"),\n    #                                      by = \"year\")), lty = 2, alpha = 0.1) +\n    geom_hline(yintercept = 1, lty = 2, alpha = 0.6) +\n    geom_line(aes(col = tegund)) +  \n    geom_text(data = plot_dat |> filter(dags == max(dags)),\n              aes(label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n    scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n                 date_labels = \"%Y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), ymd(\"2023-10-01\"))) +  \n    scale_y_tufte(labels = label_number(big.mark = \".\", decimal.mark = \",\"),\n                  breaks = tufte_breaks(plot_dat$breyting)) +  \n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    # coord_cartesian(ylim = c(0.84, 1.127)) +\n    labs(x = NULL, y = NULL,  \n         title = \"Hrein árleg breyting á fjölda starfsfólks á vinnumarkaði (2009 - 2022)\",\n         subtitle = \"Y-ás táknar mun á fjölda vinnandi frá sama mánuði á síðasta ári\") + \n    theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 5),\n          legend.position = \"none\")\n\np\n```\n\n## Eftir bakgrunni\n\n```{r}\n#| fig-width: 12\n#| fig-asp: 0.8\n#| out-width: \"100%\"\n#| column: page\n\nplot_dat <- d |>  \n    filter(rekstrarform != \"Alls starfandi\") |>  \n    count(dags, tegund, bakgrunnur, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |> \n    mutate(Heild = Annad + Opinbert) |> \n    pivot_longer(c(-dags, -bakgrunnur), names_to = \"tegund\", values_to = \"n\") |> \n    filter(year(dags) >= 2008) |>  \n    mutate(manudur = month(dags)) |>\n    group_by(manudur, tegund, bakgrunnur) |>  \n    mutate(breyting = c(0, diff(n)),\n           uppsofnud_breyting = cumsum(breyting)) |> \n    ungroup() |> \n    filter(year(dags) > min(year(dags))) |> \n    mutate(tegund = fct_recode(tegund,\n                               \"Almennur\" = \"Annad\",\n                               \"Opinber\" = \"Opinbert\"),\n           y = breyting,\n           y = case_when(tegund == \"Heild\" ~ y * 1.06,\n                         tegund == \"Almennur\" ~ y * 0.95,\n                         TRUE ~ y))\n\np1 <- plot_dat |> \n    filter(bakgrunnur == \"Íslenskur bakgrunnur\") |> \n    ggplot(aes(dags, breyting)) +  \n    geom_line(data = tibble(x = range(plot_dat$dags), y = c(0, 0)),\n              aes(x = x, y = y), lty = 2, alpha = 0.5, inherit.aes =) +\n    geom_line(aes(col = tegund)) +  \n    geom_text(data = plot_dat |> filter(dags == max(dags), bakgrunnur == \"Íslenskur bakgrunnur\"),\n              aes(y = y, label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n    geom_rangeframe(sides = \"l\") +  \n    scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n                 date_labels = \"%b/%Y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), ymd(\"2024-01-01\"))) +  \n    scale_y_continuous(labels = label_number(),\n                       breaks = c(0, range(plot_dat$breyting[plot_dat$bakgrunnur == \"Íslenskur bakgrunnur\"])),\n                       limits = range(plot_dat$breyting[plot_dat$bakgrunnur == \"Íslenskur bakgrunnur\"]), \n                       oob = oob_keep) +  \n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    facet_grid(bakgrunnur ~ .) +\n    labs(x = NULL, y = NULL,\n         title = \"Hrein árleg breyting á fjölda starfsfólks á vinnumarkaði (2009 - 2022)\",\n         subtitle = \"Y-ás táknar mun á fjölda vinnandi frá sama mánuði árið á undan\",) +  \n    coord_cartesian(clip = \"off\") +\n    theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 5),\n          legend.position = \"none\",\n          axis.line = element_blank(),\n          axis.text.x = element_blank(),\n          axis.ticks.x = element_blank())\n\np2 <- plot_dat |> \n    filter(bakgrunnur == \"Innflytjendur\") |> \n    ggplot(aes(dags, breyting)) +  \n    geom_line(data = tibble(x = range(plot_dat$dags), y = c(0, 0)),\n              aes(x = x, y = y), lty = 2, alpha = 0.5, inherit.aes = FALSE) +\n    geom_line(aes(col = tegund)) +  \n    geom_text(data = plot_dat |> filter(dags == max(dags), bakgrunnur == \"Innflytjendur\"),\n              aes(y = y, label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n    geom_rangeframe(sides = \"l\") +  \n    scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n                 date_labels = \"%b/%Y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), ymd(\"2024-01-01\"))) +  \n    scale_y_continuous(labels = label_number(),\n                       breaks = c(0, range(plot_dat$breyting[plot_dat$bakgrunnur == \"Innflytjendur\"])),\n                       limits = range(plot_dat$breyting[plot_dat$bakgrunnur == \"Innflytjendur\"]),\n                       oob = oob_keep) +  \n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    facet_grid(bakgrunnur ~ .) +\n    labs(x = NULL, y = NULL) +  \n    coord_cartesian(clip = \"off\") +\n    theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 9),\n          legend.position = \"none\",\n          axis.line = element_blank(),\n          axis.text.x = element_blank(),\n          axis.ticks.x = element_blank())\n\np3 <- plot_dat |> \n    filter(bakgrunnur == \"Alls\") |> \n    ggplot(aes(dags, breyting)) +  \n    geom_line(data = tibble(x = range(plot_dat$dags), y = c(0, 0)),\n              aes(x = x, y = y), lty = 2, alpha = 0.5, inherit.aes = FALSE) +\n    geom_line(aes(col = tegund)) +  \n    geom_text(data = plot_dat |> filter(dags == max(dags), bakgrunnur == \"Alls\"),\n              aes(y = y, label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n    geom_rangeframe() +  \n    scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n                 date_labels = \"%Y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), ymd(\"2024-01-01\"))) +  \n    scale_y_continuous(labels = label_number(),\n                       breaks = c(range(plot_dat$breyting), 0),\n                       limits = range(plot_dat$breyting),\n                       oob = oob_keep) +  \n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    facet_grid(bakgrunnur ~ .) +\n    labs(x = NULL, y = NULL,) +  \n    coord_cartesian(clip = \"off\") +\n    theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 5),\n          legend.position = \"none\",\n          axis.line = element_blank())\n\np <- plot_grid(p1, p2, p3, ncol = 1, rel_heights = c(1, 0.85, 1))\n\np\n\n```\n\n## Hlutfallsleg breyting\n\n```{r}\n#| fig-width: 12\n#| fig-asp: 0.621\n#| out-width: \"100%\"\n#| column: page\n\n\nplot_dat <- d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |> \n    mutate(Heild = Annad + Opinbert) |> \n    pivot_longer(c(-dags), names_to = \"tegund\", values_to = \"n\") |> \n    filter(year(dags) >= 2008) |>  \n    mutate(manudur = month(dags)) |>\n    group_by(manudur, tegund) |>  \n    mutate(breyting = c(1, exp(diff(log(n)))),\n           uppsofnud_breyting = exp(cumsum(log(breyting)))) |> \n    ungroup() |> \n    filter(year(dags) > min(year(dags))) |> \n    mutate(tegund = fct_recode(tegund,\n                               \"Almennur\" = \"Annad\",\n                               \"Opinber\" = \"Opinbert\"))\n\np <- plot_dat |> \n    ggplot(aes(dags, breyting)) +  \n    # geom_vline(xintercept = ymd(seq.Date(from = min(plot_dat$dags),\n    #                                      to = ymd(\"2022-01-01\"),\n    #                                      by = \"year\")), lty = 2, alpha = 0.1) +\n    geom_hline(yintercept = 1, lty = 2, alpha = 0.6) +\n    geom_line(aes(col = tegund)) +  \n    geom_text(data = plot_dat |> filter(dags == max(dags)),\n              aes(label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n    scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n                 date_labels = \"%Y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), ymd(\"2023-10-01\"))) +  \n    scale_y_tufte(breaks = tufte_breaks(plot_dat$breyting),\n                  labels = function(x) percent(x - 1),\n                  trans = \"log10\") +  \n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    coord_cartesian(ylim = c(0.84, 1.127)) +\n    labs(x = NULL, y = NULL,  \n         title = \"Hlutfallsleg árleg breyting á fjölda starfsfólks á vinnumarkaði (2009 - 2022)\",\n         subtitle = \"Y-ás er á lograkvarða svo að -50% og +100% eru jafnlangt frá 0% breytingu\") +   \n    theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 5),\n          legend.position = \"none\")\n\np\n\nggsave(plot = p, filename = \"hlutf_breyting_saman.png\",\n       width = 8, height = 0.621 * 8, scale = 1.3, bg = \"white\")\n```\n\n## Eftir bakgrunni\n\n```{r}\n#| fig-width: 12\n#| fig-asp: 0.8\n#| out-width: \"100%\"\n#| column: page\n\nplot_dat <- d |>  \n    filter(rekstrarform != \"Alls starfandi\") |>  \n    count(dags, tegund, bakgrunnur, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |> \n    mutate(Heild = Annad + Opinbert) |> \n    pivot_longer(c(-dags, -bakgrunnur), names_to = \"tegund\", values_to = \"n\") |> \n    filter(year(dags) >= 2008) |>  \n    mutate(manudur = month(dags)) |>\n    group_by(manudur, tegund, bakgrunnur) |>  \n    mutate(breyting = c(1, exp(diff(log(n))))) |> \n    ungroup() |> \n    filter(year(dags) > min(year(dags))) |> \n    mutate(tegund = fct_recode(tegund,\n                               \"Almennur\" = \"Annad\",\n                               \"Opinber\" = \"Opinbert\"),\n           y = breyting,\n           y = case_when(tegund == \"Heild\" ~ y * (1 - 0.015 * (bakgrunnur == \"Innflytjendur\")),\n                         tegund == \"Almennur\" ~ y * 1,\n                         TRUE ~ y))\n\np1 <- plot_dat |> \n    filter(bakgrunnur == \"Íslenskur bakgrunnur\") |> \n    ggplot(aes(dags, breyting)) +  \n    geom_line(data = tibble(x = range(plot_dat$dags), y = c(1, 1)),\n              aes(x = x, y = y), lty = 2, alpha = 0.5, inherit.aes = FALSE) +\n    geom_line(aes(col = tegund)) +  \n    geom_text(data = plot_dat |> filter(dags == max(dags), bakgrunnur == \"Íslenskur bakgrunnur\"),\n              aes(y = y, label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n    geom_rangeframe(sides = \"l\") +  \n    scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n                 date_labels = \"%b/%Y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), ymd(\"2024-01-01\"))) +  \n    scale_y_log10(breaks = c(range(plot_dat$breyting[plot_dat$bakgrunnur == \"Íslenskur bakgrunnur\"], na.rm = T), 1),\n                  labels = function(x) percent(x - 1)) +  \n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    facet_grid(bakgrunnur ~ .) +\n    labs(x = NULL, y = NULL,\n         title = \"Hlutfallsleg árleg breyting á fjölda starfsfólks á vinnumarkaði (2009 - 2022)\",\n         subtitle = \"Y-ás er á lograkvarða svo að -50% og +100% eru jafnlangt frá 0% breytingu\") +  \n    coord_cartesian(clip = \"off\") +\n    theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 5),\n          legend.position = \"none\",\n          axis.line = element_blank(),\n          axis.text.x = element_blank(),\n          axis.ticks.x = element_blank())\n\np2 <- plot_dat |> \n    filter(bakgrunnur == \"Innflytjendur\") |> \n    ggplot(aes(dags, breyting)) +  \n    geom_line(data = tibble(x = range(plot_dat$dags), y = c(1, 1)),\n              aes(x = x, y = y), lty = 2, alpha = 0.5, inherit.aes = FALSE) +\n    geom_line(aes(col = tegund)) +  \n    geom_text(data = plot_dat |> filter(dags == max(dags), bakgrunnur == \"Innflytjendur\"),\n              aes(y = y, label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n    geom_rangeframe(sides = \"l\") +  \n    scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n                 date_labels = \"%b/%Y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), ymd(\"2024-01-01\"))) +  \n    scale_y_log10(breaks = c(range(plot_dat$breyting[plot_dat$bakgrunnur == \"Innflytjendur\"], na.rm = T), 1),\n                  labels = function(x) percent(x - 1)) +  \n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    facet_grid(bakgrunnur ~ .) +\n    labs(x = NULL, y = NULL) +  \n    coord_cartesian(clip = \"off\") +\n    theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 9),\n          legend.position = \"none\",\n          axis.line = element_blank(),\n          axis.text.x = element_blank(),\n          axis.ticks.x = element_blank())\n\np3 <- plot_dat |> \n    filter(bakgrunnur == \"Alls\") |> \n    ggplot(aes(dags, breyting)) +  \n    geom_line(data = tibble(x = range(plot_dat$dags), y = c(1, 1)),\n              aes(x = x, y = y), lty = 2, alpha = 0.5, inherit.aes = FALSE) +\n    geom_line(aes(col = tegund)) +  \n    geom_text(data = plot_dat |> filter(dags == max(dags), bakgrunnur == \"Alls\"),\n              aes(y = y, label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n    geom_rangeframe(sides = \"lb\") +  \n    scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n                 date_labels = \"%Y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), ymd(\"2024-01-01\"))) +  \n    scale_y_log10(breaks = c(range(plot_dat$breyting[plot_dat$bakgrunnur == \"Alls\"], na.rm = T), 1),\n                  labels = function(x) percent(x - 1)) +  \n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    facet_grid(bakgrunnur ~ .) +\n    labs(x = NULL, y = NULL,) +  \n    coord_cartesian(clip = \"off\") +\n    theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 5),\n          legend.position = \"none\",\n          axis.line = element_blank())\n\np <- plot_grid(p1, p2, p3, ncol = 1, rel_heights = c(1, 0.85, 1))\n\np\n\n```\n\n:::"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":false,"freeze":true,"echo":false,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":true,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../style.css"],"output-file":"index.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.1.175","editor":"source","theme":["paper","../../theme.scss"],"title-block-banner":true,"title":"Vinnumarkaður","pagetitle":"Vinnumarkaður","subtitle":"Hver er fjöldi starfandi einstaklinga og hvernig skiptast þeir á vinnumarkaði?","description":"Reglulega sjást fyrirsagnir þar sem talað er um að opinbert starfsfólk sé allt of margt og að hlutfall þess af heildarfjölda vinnandi fólks sé of hátt. Hér kryf ég reglulega nýjustu gögnin til að geta vitað hvort slíkar fullyrðingar séu teknar úr samhengi eða endurspegli raunveruleikann.\n","author":[{"name":"Brynjólfur Gauti Guðrúnar Jónsson","url":"https://twitter.com/bgautijonsson","affiliation":"Tölfræði, Raunvísindadeild Háskóla Íslands","affiliation-url":"https://www.hi.is/tolfraedi_0"}],"date":"2022/09/10","categories":["efnahagur","vinnumarkaður","Hagstofa","R","íslenska"],"image":"hlutf_opinbert.png","twitter-card":{"image":"hlutf_opinbert.png"},"smooth-scroll":true},"extensions":{"book":{"multiFile":true}}}}}